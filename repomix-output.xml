This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
package.json
psy-admin/.gitignore
psy-admin/eslint.config.mjs
psy-admin/package.json
psy-admin/README.md
psy-admin/sanity.cli.ts
psy-admin/sanity.config.ts
psy-admin/schemaTypes/author.ts
psy-admin/schemaTypes/blockContent.ts
psy-admin/schemaTypes/category.ts
psy-admin/schemaTypes/index.ts
psy-admin/schemaTypes/post.ts
psy-admin/static/.gitkeep
psy-admin/tsconfig.json
psy-front/.gitignore
psy-front/app/[lang]/bookmarks/page.tsx
psy-front/app/[lang]/loading.tsx
psy-front/app/[lang]/menu/page.tsx
psy-front/app/[lang]/page.tsx
psy-front/app/[lang]/post/[slug]/loading.tsx
psy-front/app/[lang]/post/[slug]/page.tsx
psy-front/app/[lang]/post/[slug]/TranslationProvider.tsx
psy-front/app/[lang]/search/page.tsx
psy-front/app/api/algolia-sync/route.ts
psy-front/app/favicon.ico
psy-front/app/globals.css
psy-front/app/layout.tsx
psy-front/app/not-found.tsx
psy-front/components/article/ArticleActions.tsx
psy-front/components/article/PortableTextComponents.tsx
psy-front/components/article/TableOfContents.tsx
psy-front/components/BottomBar.tsx
psy-front/components/feed/ArticleCard.tsx
psy-front/components/feed/SearchAndFeed.tsx
psy-front/components/LanguageSwitcher.tsx
psy-front/components/search/HomeSearchTrigger.tsx
psy-front/components/search/SearchClient.tsx
psy-front/components/ThemeProvider.tsx
psy-front/components/ThemeToggle.tsx
psy-front/components/ui/BookmarkButton.tsx
psy-front/components/ui/BottomBar.tsx
psy-front/components/ui/Header.tsx
psy-front/components/ui/ProgressBar.tsx
psy-front/components/ui/ThemeToggle.tsx
psy-front/components/ui/ToastProvider.tsx
psy-front/eslint.config.mjs
psy-front/hooks/useBookmarks.ts
psy-front/lib/haptic.ts
psy-front/lib/queries.ts
psy-front/lib/sanity.ts
psy-front/middleware.ts
psy-front/next.config.ts
psy-front/package.json
psy-front/postcss.config.mjs
psy-front/public/favicon.ico
psy-front/public/file.svg
psy-front/public/globe.svg
psy-front/public/next.svg
psy-front/public/vercel.svg
psy-front/public/window.svg
psy-front/README.md
psy-front/tsconfig.json
README.md
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
lerna-debug.log*

# Diagnostic reports (https://nodejs.org/api/report.html)
report.[0-9]*.[0-9]*.[0-9]*.[0-9]*.json

# Runtime data
pids
*.pid
*.seed
*.pid.lock

# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov

# Coverage directory used by tools like istanbul
coverage
*.lcov

# nyc test coverage
.nyc_output

# Grunt intermediate storage (https://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# Bower dependency directory (https://bower.io/)
bower_components

# node-waf configuration
.lock-wscript

# Compiled binary addons (https://nodejs.org/api/addons.html)
build/Release

# Dependency directories
node_modules/
jspm_packages/

# Snowpack dependency directory (https://snowpack.dev/)
web_modules/

# TypeScript cache
*.tsbuildinfo

# Optional npm cache directory
.npm

# Optional eslint cache
.eslintcache

# Optional stylelint cache
.stylelintcache

# Optional REPL history
.node_repl_history

# Output of 'npm pack'
*.tgz

# Yarn Integrity file
.yarn-integrity

# dotenv environment variable files
.env
.env.*
!.env.example

# parcel-bundler cache (https://parceljs.org/)
.cache
.parcel-cache

# Next.js build output
.next
out

# Nuxt.js build / generate output
.nuxt
dist

# Gatsby files
.cache/
# Comment in the public line in if your project uses Gatsby and not Next.js
# https://nextjs.org/blog/next-9-1#public-directory-support
# public

# vuepress build output
.vuepress/dist

# vuepress v2.x temp and cache directory
.temp
.cache

# Sveltekit cache directory
.svelte-kit/

# vitepress build output
**/.vitepress/dist

# vitepress cache directory
**/.vitepress/cache

# Docusaurus cache and generated files
.docusaurus

# Serverless directories
.serverless/

# FuseBox cache
.fusebox/

# DynamoDB Local files
.dynamodb/

# Firebase cache directory
.firebase/

# TernJS port file
.tern-port

# Stores VSCode versions used for testing VSCode extensions
.vscode-test

# yarn v3
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/sdks
!.yarn/versions

# Vite logs files
vite.config.js.timestamp-*
vite.config.ts.timestamp-*
</file>

<file path="package.json">
{
  "dependencies": {
    "@vercel/analytics": "^1.6.1"
  }
}
</file>

<file path="psy-admin/.gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# Dependencies
/node_modules
/.pnp
.pnp.js

# Compiled Sanity Studio
/dist

# Temporary Sanity runtime, generated by the CLI on every dev server start
/.sanity

# Logs
/logs
*.log

# Coverage directory used by testing tools
/coverage

# Misc
.DS_Store
*.pem

# Typescript
*.tsbuildinfo

# Dotenv and similar local-only files
*.local
</file>

<file path="psy-admin/eslint.config.mjs">
import studio from '@sanity/eslint-config-studio'

export default [...studio]
</file>

<file path="psy-admin/README.md">
# Sanity Blogging Content Studio

Congratulations, you have now installed the Sanity Content Studio, an open-source real-time content editing environment connected to the Sanity backend.

Now you can do the following things:

- [Read ‚Äúgetting started‚Äù in the docs](https://www.sanity.io/docs/introduction/getting-started?utm_source=readme)
- Check out the example frontend: [React/Next.js](https://github.com/sanity-io/tutorial-sanity-blog-react-next)
- [Read the blog post about this template](https://www.sanity.io/blog/build-your-own-blog-with-sanity-and-next-js?utm_source=readme)
- [Join the Sanity community](https://www.sanity.io/community/join?utm_source=readme)
- [Extend and build plugins](https://www.sanity.io/docs/content-studio/extending?utm_source=readme)
</file>

<file path="psy-admin/schemaTypes/author.ts">
import {defineField, defineType} from 'sanity'

export default defineType({
  name: 'author',
  title: 'Author',
  type: 'document',
  fields: [
    defineField({
      name: 'name',
      title: 'Name',
      type: 'string',
    }),
    defineField({
      name: 'slug',
      title: 'Slug',
      type: 'slug',
      options: {
        source: 'name',
        maxLength: 96,
      },
    }),
    defineField({
      name: 'image',
      title: 'Image',
      type: 'image',
      options: {
        hotspot: true,
      },
    }),
    defineField({
      name: 'bio',
      title: 'Bio',
      type: 'array',
      of: [
        {
          title: 'Block',
          type: 'block',
          styles: [{title: 'Normal', value: 'normal'}],
          lists: [],
        },
      ],
    }),
  ],
  preview: {
    select: {
      title: 'name',
      media: 'image',
    },
  },
})
</file>

<file path="psy-admin/schemaTypes/category.ts">
import {defineField, defineType} from 'sanity'

export default defineType({
  name: 'category',
  title: 'Category',
  type: 'document',
  fields: [
    defineField({
      name: 'title',
      title: 'Title',
      type: 'string',
    }),
    defineField({
      name: 'description',
      title: 'Description',
      type: 'text',
    }),
  ],
})
</file>

<file path="psy-admin/schemaTypes/index.ts">
import blockContent from './blockContent'
import category from './category'
import post from './post'
import author from './author'

export const schemaTypes = [post, author, category, blockContent]
</file>

<file path="psy-admin/static/.gitkeep">
Files placed here will be served by the Sanity server under the `/static`-prefix
</file>

<file path="psy-admin/tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "module": "Preserve",
    "moduleDetection": "force",
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true
  },
  "include": ["**/*.ts", "**/*.tsx"],
  "exclude": ["node_modules"]
}
</file>

<file path="psy-front/.gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
</file>

<file path="psy-front/app/[lang]/loading.tsx">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Home Page Loading Skeleton ===
export default function Loading() {
  return (
    <main id="home-skeleton" className="animate-pulse">
      <div className="layout-container space-y-10">
        
        {/* –®–∞–ø–∫–∞ –∏ –ø–æ–∏—Å–∫ */}
        <section id="skeleton-hero" className="space-y-6">
          <div className="space-y-3">
            <div className="h-12 w-3/4 md:w-1/2 bg-gray-200 dark:bg-zinc-800 rounded-2xl"></div>
            <div className="h-6 w-1/2 md:w-1/3 bg-gray-200 dark:bg-zinc-800 rounded-xl"></div>
          </div>
          <div className="h-14 w-full bg-gray-200 dark:bg-zinc-800 rounded-3xl"></div>
          <div className="flex gap-3 overflow-hidden">
            {[1, 2, 3, 4, 5].map((i) => (
              <div key={i} className="h-10 w-28 shrink-0 bg-gray-200 dark:bg-zinc-800 rounded-full"></div>
            ))}
          </div>
        </section>

        {/* –°–µ—Ç–∫–∞ —Å—Ç–∞—Ç–µ–π */}
        <section id="skeleton-articles" className="space-y-8">
          <div className="h-8 w-48 bg-gray-200 dark:bg-zinc-800 rounded-xl"></div>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            {[1, 2, 3, 4].map((i) => (
              <div key={i} className="card-editorial flex flex-col h-full border border-gray-100 dark:border-zinc-800">
                <div className="w-full h-48 rounded-2xl bg-gray-200 dark:bg-zinc-800 mb-5"></div>
                <div className="h-4 w-1/3 bg-gray-200 dark:bg-zinc-800 rounded-md mb-3"></div>
                <div className="h-6 w-full bg-gray-200 dark:bg-zinc-800 rounded-lg mb-2"></div>
                <div className="h-6 w-4/5 bg-gray-200 dark:bg-zinc-800 rounded-lg mb-4"></div>
                <div className="mt-auto pt-4 border-t border-gray-100 dark:border-zinc-800">
                  <div className="h-4 w-1/2 bg-gray-200 dark:bg-zinc-800 rounded-md"></div>
                </div>
              </div>
            ))}
          </div>
        </section>

      </div>
    </main>
  );
}
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/app/[lang]/menu/page.tsx">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ú–µ–Ω—é ===
"use client";

import { useState, useEffect } from "react";
import { useTheme } from "next-themes";
import Link from "next/link";
import { usePathname, useRouter } from "next/navigation";
import { triggerHaptic } from "@/lib/haptic";

// 1. –°–æ–∑–¥–∞–µ–º —Å–ª–æ–≤–∞—Ä—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
const dictionary = {
  ru: {
    title: "–ú–µ–Ω—é",
    settings: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏",
    darkTheme: "–¢–µ–º–Ω–∞—è —Ç–µ–º–∞",
    language: "–Ø–∑—ã–∫",
    categories: "–ö–∞—Ç–µ–≥–æ—Ä–∏–∏",
    catList: ["–û—Ç–Ω–æ—à–µ–Ω–∏—è", "–í—ã–≥–æ—Ä–∞–Ω–∏–µ", "–°–∞–º–æ–æ—Ü–µ–Ω–∫–∞", "–ö–∞—Ä—å–µ—Ä–∞"]
  },
  en: {
    title: "Menu",
    settings: "Settings",
    darkTheme: "Dark mode",
    language: "Language",
    categories: "Categories",
    catList: ["Relationships", "Burnout", "Self-esteem", "Career"]
  },
  ua: {
    title: "–ú–µ–Ω—é",
    settings: "–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è",
    darkTheme: "–¢–µ–º–Ω–∞ —Ç–µ–º–∞",
    language: "–ú–æ–≤–∞",
    categories: "–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó",
    catList: ["–í—ñ–¥–Ω–æ—Å–∏–Ω–∏", "–í–∏–≥–æ—Ä–∞–Ω–Ω—è", "–°–∞–º–æ–æ—Ü—ñ–Ω–∫–∞", "–ö–∞—Ä'—î—Ä–∞"]
  },
  pl: {
    title: "Menu",
    settings: "Ustawienia",
    darkTheme: "Tryb ciemny",
    language: "Jƒôzyk",
    categories: "Kategorie",
    catList: ["Relacje", "Wypalenie", "Samoocena", "Kariera"]
  },
  de: {
    title: "Men√º",
    settings: "Einstellungen",
    darkTheme: "Dunkler Modus",
    language: "Sprache",
    categories: "Kategorien",
    catList: ["Beziehungen", "Burnout", "Selbstwertgef√ºhl", "Karriere"]
  }
};

export default function MenuPage() {
  const [mounted, setMounted] = useState(false);
  const { theme, setTheme, systemTheme } = useTheme();
  
  const pathname = usePathname();
  const router = useRouter();

  useEffect(() => {
    setMounted(true);
  }, []);

  const currentTheme = theme === "system" ? systemTheme : theme;

  const toggleTheme = () => {
    triggerHaptic('light');
    setTheme(currentTheme === "dark" ? "light" : "dark");
  };

  const currentLang = (pathname?.split("/")[1] || "ru") as keyof typeof dictionary;
  
  // 2. –î–æ—Å—Ç–∞–µ–º –Ω—É–∂–Ω—ã–µ —Å–ª–æ–≤–∞ –∏–∑ —Å–ª–æ–≤–∞—Ä—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —è–∑—ã–∫–∞
  const t = dictionary[currentLang] || dictionary.ru;

  const handleLanguageChange = (e: React.ChangeEvent<HTMLSelectElement>) => {
    triggerHaptic('light');
    const locale = e.target.value;
    
    if (!pathname) {
      router.push(`/${locale}`);
      return;
    }
    
    const segments = pathname.split("/");
    segments[1] = locale;
    router.push(segments.join("/"));
    router.refresh();
  };

  return (
    <main id="menu-page">
      <div className="layout-container space-y-8">
        
        {/* –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ª–æ–≤–∞—Ä—å –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ */}
        <h1 className="text-4xl md:text-5xl font-black text-gray-900 dark:text-zinc-50 tracking-tight px-2">
          {t.title}
        </h1>

        <section id="menu-settings" className="card-editorial space-y-6">
          <h2 className="text-sm font-bold text-gray-400 uppercase tracking-wider">
            {t.settings}
          </h2>

          <div className="flex items-center justify-between">
            <span className="text-lg font-medium text-gray-900 dark:text-white">
              {t.darkTheme}
            </span>
            
            {!mounted ? (
              <div className="w-14 h-8 bg-gray-200 dark:bg-zinc-700 rounded-full animate-pulse" />
            ) : (
              <button
                onClick={toggleTheme}
                className={`w-14 h-8 rounded-full relative transition-colors duration-300 focus:outline-none ${
                  currentTheme === "dark" ? "bg-blue-600" : "bg-gray-300 dark:bg-zinc-600"
                }`}
                aria-label="Toggle theme"
              >
                <span
                  className={`absolute top-1 left-1 w-6 h-6 bg-white rounded-full shadow-sm transition-transform duration-300 ${
                    currentTheme === "dark" ? "translate-x-6" : "translate-x-0"
                  }`}
                />
              </button>
            )}
          </div>

          <div className="h-px bg-gray-100 dark:bg-zinc-800 w-full" />

          <div className="flex items-center justify-between">
            <span className="text-lg font-medium text-gray-900 dark:text-white">
              {t.language}
            </span>
            <select
              onChange={handleLanguageChange}
              value={currentLang}
              className="bg-gray-50 dark:bg-zinc-800 text-gray-900 dark:text-white border border-gray-200 dark:border-zinc-700 rounded-xl px-4 py-2 outline-none focus:ring-2 focus:ring-blue-500 font-medium appearance-none cursor-pointer"
            >
              <option value="ru">–†—É—Å—Å–∫–∏–π (RU)</option>
              <option value="en">English (EN)</option>
              <option value="ua">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ (UA)</option>
              <option value="pl">Polski (PL)</option>
              <option value="de">Deutsch (DE)</option>
            </select>
          </div>
        </section>

        <section id="menu-categories" className="card-editorial space-y-4">
          <h2 className="text-sm font-bold text-gray-400 uppercase tracking-wider mb-2">
            {t.categories}
          </h2>
          <nav className="flex flex-col space-y-5">
            {/* –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑ —Å–ª–æ–≤–∞—Ä—è */}
            {t.catList.map((item, index) => {
              // –î–ª—è —Å—Å—ã–ª–∫–∏ –±–µ—Ä–µ–º –∞–Ω–≥–ª–∏–π—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (–∏–ª–∏ —Å–ª–∞–≥), —á—Ç–æ–±—ã URL –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–ª,
              // –Ω–æ —Ç—É—Ç –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–Ω–¥–µ–∫—Å –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –º–∞—Å—Å–∏–≤–∞ –∏–ª–∏ —Ä—É—Å—Å–∫–∏–π –∫–ª—é—á, 
              // –µ—Å–ª–∏ —É —Ç–µ–±—è —Å–ª–∞–≥–∏ –≤ –±–∞–∑–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º. –ü–æ–∫–∞ –æ—Å—Ç–∞–≤–ª—è–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å–ª–∞–≥–∞ –∫–∞–∫ –±—ã–ª–∞:
              const slug = dictionary.ru.catList[index].toLowerCase(); 
              return (
                <Link
                  key={item}
                  href={`/${currentLang}/category/${slug}`}
                  className="text-xl font-bold text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 transition-colors"
                  onClick={() => triggerHaptic('light')}
                >
                  {item}
                </Link>
              );
            })}
          </nav>
        </section>

      </div>
    </main>
  );
}
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/app/[lang]/post/[slug]/loading.tsx">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Post Page Loading Skeleton ===
export default function Loading() {
  return (
    <main id="post-skeleton" className="animate-pulse">
      <article className="layout-container max-w-3xl mx-auto space-y-8">
        
        {/* –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ */}
        <div className="h-4 w-32 bg-gray-200 dark:bg-zinc-800 rounded-md mb-8"></div>
        
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
        <div className="space-y-3 mb-6">
          <div className="h-10 md:h-12 w-full bg-gray-200 dark:bg-zinc-800 rounded-xl"></div>
          <div className="h-10 md:h-12 w-4/5 bg-gray-200 dark:bg-zinc-800 rounded-xl"></div>
        </div>

        {/* –ú–µ—Ç–∞-—Ç–µ–≥–∏ */}
        <div className="flex gap-4 mb-10">
          <div className="h-6 w-24 bg-gray-200 dark:bg-zinc-800 rounded-full"></div>
          <div className="h-6 w-20 bg-gray-200 dark:bg-zinc-800 rounded-md"></div>
        </div>

        {/* –ì–ª–∞–≤–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ */}
        <div className="w-full aspect-video rounded-3xl bg-gray-200 dark:bg-zinc-800 mb-12"></div>

        {/* –¢–µ–∫—Å—Ç (–∏–º–∏—Ç–∞—Ü–∏—è –∞–±–∑–∞—Ü–µ–≤) */}
        <div className="space-y-4">
          <div className="h-4 w-full bg-gray-200 dark:bg-zinc-800 rounded-md"></div>
          <div className="h-4 w-full bg-gray-200 dark:bg-zinc-800 rounded-md"></div>
          <div className="h-4 w-11/12 bg-gray-200 dark:bg-zinc-800 rounded-md"></div>
          <br />
          <div className="h-4 w-full bg-gray-200 dark:bg-zinc-800 rounded-md"></div>
          <div className="h-4 w-4/5 bg-gray-200 dark:bg-zinc-800 rounded-md"></div>
        </div>

      </article>
    </main>
  );
}
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/app/api/algolia-sync/route.ts">
// app/api/algolia-sync/route.ts
import { NextResponse } from 'next/server';
// –ò–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π –∏–º–ø–æ—Ä—Ç –¥–ª—è v5
import { algoliasearch } from 'algoliasearch';

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–ª–∏–µ–Ω—Ç Algolia. 
// –í–ê–ñ–ù–û: –ó–¥–µ—Å—å –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º ADMIN_KEY, —Ç–∞–∫ –∫–∞–∫ –Ω–∞–º –Ω—É–∂–Ω—ã –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å.
const client = algoliasearch(
  process.env.NEXT_PUBLIC_ALGOLIA_APP_ID!,
  process.env.ALGOLIA_ADMIN_KEY!
);

const indexName = 'posts_index';

export async function POST(req: Request) {
  try {
    // –ß–∏—Ç–∞–µ–º –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏—Å–ª–∞–ª Sanity Webhook
    const body = await req.json();

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫ –Ω–∞–º –ø—Ä–∏—à–ª–∞ –∏–º–µ–Ω–Ω–æ —Å—Ç–∞—Ç—å—è, –∞ –Ω–µ –¥—Ä—É–≥–æ–π —Ç–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞
    if (body._type !== 'post') {
      return NextResponse.json({ message: 'Not a post, ignoring.' }, { status: 200 });
    }

    // –ï—Å–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç –±—ã–ª —É–¥–∞–ª–µ–Ω –≤ Sanity -> —É–¥–∞–ª—è–µ–º –µ–≥–æ –∏–∑ Algolia (–°–∏–Ω—Ç–∞–∫—Å–∏—Å v5)
    if (body._deleted) {
      await client.deleteObject({
        indexName: indexName,
        objectID: body._id
      });
      return NextResponse.json({ message: `Deleted document ${body._id} from Algolia` });
    }

    // –§–æ—Ä–º–∏—Ä—É–µ–º —á–∏—Å—Ç—É—é –∑–∞–ø–∏—Å—å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤ Algolia
    const record = {
      objectID: body._id, // Algolia –û–ë–û–ñ–ê–ï–¢ –ø–æ–ª–µ objectID, —ç—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
      title: body.title,
      slug: body.slug?.current || body.slug,
      category: body.category || "–°—Ç–∞—Ç—å—è",
    };

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º/–û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ Algolia (–°–∏–Ω—Ç–∞–∫—Å–∏—Å v5)
    await client.saveObject({
      indexName: indexName,
      body: record
    });

    return NextResponse.json({ success: true, message: `Document ${body._id} synced to Algolia` });
    
  } catch (error) {
    console.error('Algolia Sync Error:', error);
    return NextResponse.json({ success: false, message: 'Sync failed' }, { status: 500 });
  }
}
</file>

<file path="psy-front/components/article/PortableTextComponents.tsx">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Custom Portable Text (with IDs) ===
import Image from "next/image";
import { PortableTextComponents } from "@portabletext/react";
import { urlFor } from "@/lib/sanity"; // –£–±–µ–¥–∏—Å—å, —á—Ç–æ urlFor –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ lib/sanity

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è slug –∏–∑ —Ç–µ–∫—Å—Ç–∞ (–ü—Ä–∏–≤–µ—Ç –ú–∏—Ä -> privet-mir)
export const slugify = (text: string) => {
  return text
    .toString()
    .toLowerCase()
    .trim()
    .replace(/\s+/g, "-")
    .replace(/[^\w–∞-—è—ë\-]+/g, "")
    .replace(/\-\-+/g, "-");
};

export const ptComponents: PortableTextComponents = {
  types: {
    image: ({ value }: any) => {
      if (!value?.asset?._ref) return null;
      return (
        <div className="my-8 relative w-full rounded-2xl overflow-hidden bg-gray-100 dark:bg-zinc-800">
           <Image
             src={urlFor(value).url()}
             alt={value.alt || "Article image"}
             width={800}
             height={500}
             className="w-full h-auto object-cover"
             loading="lazy" // –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ –¢–ó
           />
           {value.caption && (
             <div className="text-center text-xs text-gray-500 mt-2 italic">
               {value.caption}
             </div>
           )}
        </div>
      );
    },
  },
  block: {
    // –í–ê–ñ–ù–û: –î–æ–±–∞–≤–ª—è–µ–º ID –∫ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º –¥–ª—è —Ä–∞–±–æ—Ç—ã –û–≥–ª–∞–≤–ª–µ–Ω–∏—è
    h2: ({ children, value }: any) => {
      // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å —á–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç –∏–∑ children (React nodes)
      // fallback –Ω–∞ —Å–ª—É—á–∞–π —Å–ª–æ–∂–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
      const text = value.children?.[0]?.text || String(children);
      const id = slugify(text);
      return (
        <h2 id={id} className="scroll-mt-24 text-2xl sm:text-3xl font-extrabold tracking-tight mt-12 mb-6 text-gray-900 dark:text-white first:mt-0">
          {children}
        </h2>
      );
    },
    h3: ({ children, value }: any) => {
      const text = value.children?.[0]?.text || String(children);
      const id = slugify(text);
      return (
        <h3 id={id} className="scroll-mt-24 text-xl sm:text-2xl font-bold mt-8 mb-4 text-gray-900 dark:text-white">
          {children}
        </h3>
      );
    },
    normal: ({ children }) => (
      <p className="mb-6 text-lg leading-relaxed text-gray-700 dark:text-gray-300">
        {children}
      </p>
    ),
    blockquote: ({ children }) => (
      <blockquote className="border-l-4 border-blue-600 pl-6 py-2 my-8 italic text-xl text-gray-800 dark:text-gray-200 bg-gray-50 dark:bg-zinc-800/50 rounded-r-xl">
        {children}
      </blockquote>
    ),
  },
  list: {
    bullet: ({ children }) => <ul className="list-disc pl-6 mb-6 space-y-2 text-lg text-gray-700 dark:text-gray-300 marker:text-blue-500">{children}</ul>,
    number: ({ children }) => <ol className="list-decimal pl-6 mb-6 space-y-2 text-lg text-gray-700 dark:text-gray-300 marker:font-bold">{children}</ol>,
  },
};
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/components/article/TableOfContents.tsx">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Table of Contents ===
"use client";

import { useState, useEffect } from "react";
import { ChevronDown, ChevronUp, List } from "lucide-react";

interface Heading {
  _key: string;
  text: string;
  level: number; // 2 –¥–ª—è h2, 3 –¥–ª—è h3
  slug: string;
}

export default function TableOfContents({ headings, lang }: { headings: Heading[]; lang: string }) {
  const [isOpen, setIsOpen] = useState(false);
  const [activeId, setActiveId] = useState("");

  // –¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —è–∑—ã–∫–∞
  const title = {
    ru: "–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ",
    en: "Table of Contents",
    ua: "–ó–º—ñ—Å—Ç",
    pl: "Spis tre≈õci",
    de: "Inhaltsverzeichnis"
  }[lang] || "Content";

  // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ–∫—Ü–∏–∏ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
  useEffect(() => {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            setActiveId(entry.target.id);
          }
        });
      },
      { rootMargin: "0px 0px -80% 0px" }
    );

    headings.forEach((h) => {
      const el = document.getElementById(h.slug);
      if (el) observer.observe(el);
    });

    return () => observer.disconnect();
  }, [headings]);

  if (headings.length === 0) return null;

  const scrollTo = (slug: string) => {
    const el = document.getElementById(slug);
    if (el) {
      // –°–∫—Ä–æ–ª–ª —Å —É—á–µ—Ç–æ–º —à–∞–ø–∫–∏ (offset 100px)
      const y = el.getBoundingClientRect().top + window.pageYOffset - 100;
      window.scrollTo({ top: y, behavior: "smooth" });
      setIsOpen(false); // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é –Ω–∞ –º–æ–±–∏–ª–∫–µ –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞
    }
  };

  return (
    <nav className="mb-8 lg:mb-0">
      {/* MOBILE: –†–∞—Å–∫—Ä—ã–≤–∞—à–∫–∞ */}
      <div className="lg:hidden border border-gray-200 dark:border-zinc-800 rounded-2xl overflow-hidden bg-gray-50 dark:bg-zinc-900/50">
        <button
          onClick={() => setIsOpen(!isOpen)}
          className="w-full flex items-center justify-between p-4 font-bold text-gray-900 dark:text-white"
        >
          <span className="flex items-center gap-2">
            <List size={18} className="text-blue-600" />
            {title}
          </span>
          {isOpen ? <ChevronUp size={18} /> : <ChevronDown size={18} />}
        </button>
        
        {isOpen && (
          <div className="border-t border-gray-200 dark:border-zinc-800 p-4 space-y-3 bg-white dark:bg-zinc-900">
            {headings.map((h) => (
              <button
                key={h._key}
                onClick={() => scrollTo(h.slug)}
                className={`block text-left text-sm leading-snug w-full ${
                  h.level === 3 ? "pl-4 text-gray-500" : "font-medium text-gray-800 dark:text-gray-200"
                } hover:text-blue-600 transition-colors`}
              >
                {h.text}
              </button>
            ))}
          </div>
        )}
      </div>

      {/* DESKTOP: Sticky Sidebar */}
      <div className="hidden lg:block sticky top-24 max-w-[280px]">
        <h4 className="text-xs font-bold uppercase tracking-widest text-gray-400 mb-4 flex items-center gap-2">
           <List size={14} /> {title}
        </h4>
        <ul className="space-y-3 relative border-l border-gray-200 dark:border-zinc-800 ml-2">
           {headings.map((h) => (
             <li key={h._key} className={`relative pl-4 ${h.level === 3 ? "ml-4" : ""}`}>
               <button
                 onClick={() => scrollTo(h.slug)}
                 className={`text-left text-sm transition-all duration-300 ${
                   activeId === h.slug
                     ? "text-blue-600 font-bold scale-105 origin-left"
                     : "text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100"
                 }`}
               >
                 {h.text}
               </button>
               
               {/* –ê–∫—Ç–∏–≤–Ω—ã–π –º–∞—Ä–∫–µ—Ä —Å–ª–µ–≤–∞ */}
               {activeId === h.slug && (
                 <div className="absolute -left-[1px] top-0 bottom-0 w-[2px] bg-blue-600" />
               )}
             </li>
           ))}
        </ul>
      </div>
    </nav>
  );
}
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/components/BottomBar.tsx">
"use client";

import Link from "next/link";
import { usePathname } from "next/navigation";

// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: –ú–û–ë–ò–õ–¨–ù–û–ï –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ (BOTTOM BAR) ===
export default function BottomBar() {
  // usePathname –ø–æ–º–æ–≥–∞–µ—Ç –Ω–∞–º —É–∑–Ω–∞—Ç—å, –Ω–∞ –∫–∞–∫–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –º—ã –Ω–∞—Ö–æ–¥–∏–º—Å—è, —á—Ç–æ–±—ã –ø–æ–¥—Å–≤–µ—Ç–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—É—é –∏–∫–æ–Ω–∫—É
  const pathname = usePathname();

  // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞—à–µ–≥–æ –º–µ–Ω—é (–ü—É–Ω–∫—Ç 5 –¢–ó)
  const navItems = [
    {
      id: "nav-home",
      label: "–ì–ª–∞–≤–Ω–∞—è",
      href: "/",
      // SVG –∏–∫–æ–Ω–∫–∞ –¥–æ–º–∏–∫–∞
      icon: (
        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
        </svg>
      ),
    },
    {
      id: "nav-search",
      label: "–ü–æ–∏—Å–∫",
      href: "/search",
      icon: (
        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
      ),
    },
    {
      id: "nav-bookmarks",
      label: "–ó–∞–∫–ª–∞–¥–∫–∏",
      href: "/bookmarks",
      icon: (
        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z" />
        </svg>
      ),
    },
    {
      id: "nav-menu",
      label: "–ú–µ–Ω—é",
      href: "/menu",
      icon: (
        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      ),
    },
  ];

  return (
    // –ö–ª–∞—Å—Å md:hidden —Å–∫—Ä—ã–≤–∞–µ—Ç –ø–∞–Ω–µ–ª—å –Ω–∞ –ø–ª–∞–Ω—à–µ—Ç–∞—Ö –∏ –ü–ö
    // pb-safe (safe-area-inset-bottom) –Ω—É–∂–µ–Ω –¥–ª—è –∞–π—Ñ–æ–Ω–æ–≤ —Å "—á–µ–ª–æ—á–∫–æ–π" –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞
    <nav
      id="mobile-bottom-bar"
      className="md:hidden fixed bottom-0 left-0 w-full z-50 bg-white/90 dark:bg-[#0a0a0a]/90 backdrop-blur-md border-t border-gray-200 dark:border-gray-800 transition-colors duration-500 pb-[env(safe-area-inset-bottom)]"
    >
      <div className="flex justify-around items-center h-16">
        {navItems.map((item) => {
          const isActive = pathname === item.href;
          return (
            <Link
              key={item.id}
              id={item.id}
              href={item.href}
              className={`flex flex-col items-center justify-center w-full h-full space-y-1 transition-colors ${
                isActive
                  ? "text-blue-600 dark:text-blue-400"
                  : "text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100"
              }`}
            >
              {item.icon}
              <span className="text-[10px] font-medium">{item.label}</span>
            </Link>
          );
        })}
      </div>
    </nav>
  );
}
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/components/search/HomeSearchTrigger.tsx">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Home Search Trigger ===
"use client";

import { useRouter } from "next/navigation";
import { Search } from "lucide-react";

export default function HomeSearchTrigger() {
  const router = useRouter();

  return (
    <div 
      onClick={() => router.push('/search')} 
      className="relative w-full cursor-text group"
    >
      <div className="absolute inset-y-0 left-0 flex items-center pl-7 pointer-events-none text-gray-400 group-hover:text-blue-500 transition-colors">
        <Search size={20} />
      </div>
      <div className="w-full py-4 pl-14 pr-7 text-lg bg-gray-50 dark:bg-zinc-900 border border-gray-200 dark:border-zinc-800 text-gray-500 dark:text-zinc-400 rounded-full shadow-sm transition-all flex items-center">
        –ù–∞–π—Ç–∏ —Å—Ç–∞—Ç—å—é, —Ç–µ–º—É –∏–ª–∏ –∞–≤—Ç–æ—Ä–∞...
      </div>
    </div>
  );
}
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/components/ThemeProvider.tsx">
"use client";

import { ThemeProvider as NextThemesProvider } from "next-themes";

export default function ThemeProvider({ children }: { children: React.ReactNode }) {
  return (
    <NextThemesProvider 
      attribute="class" 
      defaultTheme="system" 
      enableSystem
      disableTransitionOnChange // –í–∞–∂–Ω–æ: —É–±–∏—Ä–∞–µ—Ç –º–∏–∫—Ä–æ-–ª–∞–≥ –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç—Ä–∞–Ω–∏—Ü
    >
      {children}
    </NextThemesProvider>
  );
}
</file>

<file path="psy-front/components/ThemeToggle.tsx">
"use client";

import { useTheme } from "next-themes";
import { useEffect, useState } from "react";

// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: –ö–ù–û–ü–ö–ê –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–Ø –¢–ï–ú–´ ===
export default function ThemeToggle() {
  const { theme, setTheme } = useTheme();
  const [mounted, setMounted] = useState(false);

  useEffect(() => setMounted(true), []);

  if (!mounted) return null;

  return (
    <button
      id="theme-toggle-btn"
      onClick={() => setTheme(theme === "dark" ? "light" : "dark")}
      // –î–æ–±–∞–≤–∏–ª–∏ "hidden md:flex" –≤ —Å–∞–º–æ–µ –Ω–∞—á–∞–ª–æ
      className="hidden md:flex fixed bottom-6 right-6 z-50 p-3 lg:p-4 bg-white/90 dark:bg-gray-800/90 backdrop-blur-md shadow-lg border border-gray-200 dark:border-gray-700 rounded-full transition-all duration-300 hover:scale-110 active:scale-95 items-center justify-center text-xl"
      aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É"
    >
      {theme === "dark" ? "üåô" : "‚òÄÔ∏è"}
    </button>
  );
}
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/components/ui/ToastProvider.tsx">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Toast Notification System ===
"use client";

import { createContext, useContext, useState, ReactNode, useEffect } from "react";
import { X, Info } from "lucide-react";

type ToastMessage = {
  id: string;
  message: string;
  type: "info" | "error" | "success";
};

type ToastContextType = {
  showToast: (message: string, type?: "info" | "error" | "success") => void;
};

const ToastContext = createContext<ToastContextType | undefined>(undefined);

export function ToastProvider({ children }: { children: ReactNode }) {
  const [toasts, setToasts] = useState<ToastMessage[]>([]);

  const showToast = (message: string, type: "info" | "error" | "success" = "info") => {
    const id = Math.random().toString(36).substring(7);
    setToasts((prev) => [...prev, { id, message, type }]);

    // –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(() => {
      setToasts((prev) => prev.filter((t) => t.id !== id));
    }, 4000);
  };

  const removeToast = (id: string) => {
    setToasts((prev) => prev.filter((t) => t.id !== id));
  };

  return (
    <ToastContext.Provider value={{ showToast }}>
      {children}
      {/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–°–ø—Ä–∞–≤–∞ –≤–Ω–∏–∑—É –Ω–∞ –ü–ö, –≤–Ω–∏–∑—É –ø–æ —Ü–µ–Ω—Ç—Ä—É –Ω–∞ Mobile) */}
      <div className="fixed bottom-4 right-4 z-[9999] flex flex-col gap-2 w-full max-w-[350px] px-4 sm:px-0">
        {toasts.map((toast) => (
          <div
            key={toast.id}
            className="flex items-center gap-3 p-4 bg-[#111827] text-white rounded-2xl shadow-lg border border-gray-800 animate-in slide-in-from-bottom-5 fade-in duration-300"
          >
            <Info className="w-5 h-5 text-blue-500 shrink-0" />
            <p className="text-sm font-medium leading-tight flex-1">{toast.message}</p>
            <button onClick={() => removeToast(toast.id)} className="text-gray-400 hover:text-white">
              <X className="w-4 h-4" />
            </button>
          </div>
        ))}
      </div>
    </ToastContext.Provider>
  );
}

export const useToast = () => {
  const context = useContext(ToastContext);
  if (!context) throw new Error("useToast must be used within a ToastProvider");
  return context;
};
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/eslint.config.mjs">
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;
</file>

<file path="psy-front/hooks/useBookmarks.ts">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: –•—É–∫ –ó–∞–∫–ª–∞–¥–æ–∫ (localStorage) ===
"use client";

import { useState, useEffect } from "react";

export function useBookmarks() {
  const [bookmarks, setBookmarks] = useState<string[]>([]);
  const [mounted, setMounted] = useState(false);

  // –ó–∞—â–∏—Ç–∞ –æ—Ç Hydration Mismatch: —á–∏—Ç–∞–µ–º localStorage –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ –º–∞—É–Ω—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞
  useEffect(() => {
    setMounted(true);
    try {
      const stored = localStorage.getItem("health_psy_bookmarks");
      if (stored) {
        setBookmarks(JSON.parse(stored));
      }
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –∑–∞–∫–ª–∞–¥–æ–∫:", error);
    }
  }, []);

  const toggleBookmark = (id: string) => {
    let updatedBookmarks;
    if (bookmarks.includes(id)) {
      updatedBookmarks = bookmarks.filter((bId) => bId !== id);
    } else {
      updatedBookmarks = [...bookmarks, id];
    }
    
    setBookmarks(updatedBookmarks);
    try {
      localStorage.setItem("health_psy_bookmarks", JSON.stringify(updatedBookmarks));
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–∫–ª–∞–¥–æ–∫:", error);
    }
  };

  const isBookmarked = (id: string) => bookmarks.includes(id);

  return { bookmarks, toggleBookmark, isBookmarked, mounted };
}
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/lib/haptic.ts">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Haptic Feedback Utility ===
export const triggerHaptic = (type: 'light' | 'medium' | 'heavy' = 'light') => {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–±—Ä–∞—Ü–∏—é
  if (typeof window === 'undefined' || !navigator.vibrate) return;
  
  const patterns = {
    light: 50, // –õ–µ–≥–∫–∏–π –∫–æ—Ä–æ—Ç–∫–∏–π –∫–ª–∏–∫
    medium: 100, // –ë–æ–ª–µ–µ –æ—â—É—Ç–∏–º—ã–π
    heavy: [50, 50, 50], // –¢—Ä–æ–π–Ω–æ–π –¥–ª—è –æ—à–∏–±–æ–∫/–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
  };
  
  navigator.vibrate(patterns[type]);
};
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/middleware.ts">
// middleware.ts
import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

// –°–ø–∏—Å–æ–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —è–∑—ã–∫–æ–≤ (—Ç–µ –∂–µ, —á—Ç–æ –º—ã –∑–∞–¥–∞–ª–∏ –≤ Sanity)
const locales = ['ru', 'en', 'ua', 'pl', 'de'];
const defaultLocale = 'ru'; // –Ø–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

export function middleware(request: NextRequest) {
  const { pathname } = request.nextUrl;

  // 1. –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã Next.js, –∫–∞—Ä—Ç–∏–Ω–∫–∏ –∏ –∞–¥–º–∏–Ω–∫—É Sanity (!–í–ê–ñ–ù–û!)
  if (
    pathname.startsWith('/_next') ||
    pathname.startsWith('/studio') || // –ó–∞—â–∏—â–∞–µ–º –∞–¥–º–∏–Ω–∫—É
    pathname.startsWith('/api') ||
    pathname.includes('.') // –§–∞–π–ª—ã –≤—Ä–æ–¥–µ favicon.ico –∏–ª–∏ robots.txt
  ) {
    return NextResponse.next();
  }

  // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –ª–æ–∫–∞–ª—å –≤ URL (–Ω–∞–ø—Ä–∏–º–µ—Ä, /en/post/...)
  const pathnameHasLocale = locales.some(
    (locale) => pathname.startsWith(`/${locale}/`) || pathname === `/${locale}`
  );

  // –ï—Å–ª–∏ –ª–æ–∫–∞–ª—å —É–∂–µ –µ—Å—Ç—å, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –¥–∞–ª—å—à–µ
  if (pathnameHasLocale) return NextResponse.next();

  // 3. –ï—Å–ª–∏ –ª–æ–∫–∞–ª–∏ –Ω–µ—Ç (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—à–µ–ª –Ω–∞ –∫–æ—Ä–µ–Ω—å /), –¥–µ–ª–∞–µ–º —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –¥–µ—Ñ–æ–ª—Ç–Ω—É—é (ru)
  request.nextUrl.pathname = `/${defaultLocale}${pathname}`;
  return NextResponse.redirect(request.nextUrl);
}

// –£–∫–∞–∑—ã–≤–∞–µ–º Next.js, –¥–ª—è –∫–∞–∫–∏—Ö –ø—É—Ç–µ–π –∑–∞–ø—É—Å–∫–∞—Ç—å —ç—Ç–æ—Ç middleware
export const config = {
  matcher: [
    // –ü—Ä–∏–º–µ–Ω—è—Ç—å –∫–æ –≤—Å–µ–º –ø—É—Ç—è–º–∏, –∫—Ä–æ–º–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∏ —Å—Ç–∞—Ç–∏–∫–∏
    '/((?!_next/static|_next/image|favicon.ico).*)',
  ],
};
</file>

<file path="psy-front/postcss.config.mjs">
const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;
</file>

<file path="psy-front/public/file.svg">
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>
</file>

<file path="psy-front/public/globe.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>
</file>

<file path="psy-front/public/next.svg">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>
</file>

<file path="psy-front/public/vercel.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>
</file>

<file path="psy-front/public/window.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>
</file>

<file path="psy-front/README.md">
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
</file>

<file path="psy-front/tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}
</file>

<file path="README.md">
# health-psy
</file>

<file path="psy-front/app/[lang]/post/[slug]/TranslationProvider.tsx">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Translation Provider (UI Buttons) ===
"use client";

import { useRouter } from 'next/navigation';

interface Props {
  translations: Record<string, string>; // { en: "slug-en", ru: "slug-ru" }
  currentLang: string;
}

export default function TranslationProvider({ translations, currentLang }: Props) {
  const router = useRouter();

  // –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —è–∑—ã–∫–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç–µ
  const languages = [
    { code: 'ru', label: 'RU' },
    { code: 'en', label: 'EN' },
    { code: 'ua', label: 'UA' },
    { code: 'pl', label: 'PL' },
    { code: 'de', label: 'DE' }
  ];

  // –§–∏–ª—å—Ç—Ä—É–µ–º:
  // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–µ—Ä–µ–≤–æ–¥ –¥–ª—è —ç—Ç–æ–≥–æ —è–∑—ã–∫–∞ (translations[code]).
  // 2. –ò—Å–∫–ª—é—á–∞–µ–º —Ç–µ–∫—É—â–∏–π —è–∑—ã–∫ (currentLang), —á—Ç–æ–±—ã –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É —è–∑—ã–∫–∞, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –º—ã —É–∂–µ –Ω–∞—Ö–æ–¥–∏–º—Å—è.
  const availableTranslations = languages.filter(
    lang => translations[lang.code] && lang.code !== currentLang
  );

  // –ï—Å–ª–∏ –¥—Ä—É–≥–∏—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –Ω–µ—Ç, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–∏—á–µ–≥–æ –Ω–µ —Ä–∏—Å—É–µ—Ç
  if (availableTranslations.length === 0) return null;

  return (
    <div className="fixed bottom-24 right-4 z-40 flex flex-col gap-2 animate-in fade-in slide-in-from-bottom-4 duration-500">
      {availableTranslations.map((lang) => (
        <button
          key={lang.code}
          // –ü—Ä–∏ –∫–ª–∏–∫–µ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–µ—Ä–µ–≤–æ–¥–∞
          onClick={() => router.push(`/${lang.code}/post/${translations[lang.code]}`)}
          className="bg-white dark:bg-zinc-800 text-gray-900 dark:text-white p-3 rounded-full shadow-lg border border-gray-200 dark:border-zinc-700 hover:scale-110 transition-transform flex items-center justify-center font-bold text-xs w-12 h-12"
          aria-label={`Switch to ${lang.label}`}
        >
          {lang.label}
        </button>
      ))}
    </div>
  );
}
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/app/not-found.tsx">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: –°—Ç—Ä–∞–Ω–∏—Ü–∞ 404 ===
"use client";

import Link from "next/link";
import { usePathname } from "next/navigation";

const notFoundTranslations = {
  ru: {
    message: "–ö–∞–∂–µ—Ç—Å—è, –≤—ã —Å–≤–µ—Ä–Ω—É–ª–∏ –Ω–µ —Ç—É–¥–∞. –ù–æ –≤ –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏ –Ω–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø—É—Ç–µ–π ‚Äî –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–π –æ–ø—ã—Ç.",
    btnText: "–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é"
  },
  en: {
    message: "Looks like you took a wrong turn. But in psychology, there are no wrong paths ‚Äî only new experiences.",
    btnText: "Back to Home"
  },
  ua: {
    message: "–ó–¥–∞—î—Ç—å—Å—è, –≤–∏ –∑–≤–µ—Ä–Ω—É–ª–∏ –Ω–µ —Ç—É–¥–∏. –ê–ª–µ –≤ –ø—Å–∏—Ö–æ–ª–æ–≥—ñ—ó –Ω–µ–º–∞—î –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö —à–ª—è—Ö—ñ–≤ ‚Äî —î –ª–∏—à–µ –Ω–æ–≤–∏–π –¥–æ—Å–≤—ñ–¥.",
    btnText: "–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –Ω–∞ –≥–æ–ª–æ–≤–Ω—É"
  },
  pl: {
    message: "WyglƒÖda na to, ≈ºe skrƒôci≈Çe≈õ w z≈ÇƒÖ stronƒô. Ale w psychologii nie ma z≈Çych ≈õcie≈ºek ‚Äî sƒÖ tylko nowe do≈õwiadczenia.",
    btnText: "Wr√≥ƒá do strony g≈Ç√≥wnej"
  },
  de: {
    message: "Sieht so aus, als w√§ren Sie falsch abgebogen. Aber in der Psychologie gibt es keine falschen Wege ‚Äî nur neue Erfahrungen.",
    btnText: "Zur√ºck zur Startseite"
  }
};

export default function NotFound() {
  const pathname = usePathname();
  
  // –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–æ–¥ —è–∑—ã–∫–∞ –∏–∑ URL (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'en' –∏–∑ '/en/something')
  const langMatch = pathname?.split('/')[1];
  const isValidLang = ['ru', 'en', 'ua', 'pl', 'de'].includes(langMatch || "");
  const lang = isValidLang ? (langMatch as keyof typeof notFoundTranslations) : "ru";
  
  const t = notFoundTranslations[lang];

  return (
    <main id="global-not-found" className="min-h-screen flex items-center justify-center py-16">
      <div className="layout-container flex flex-col items-center text-center">
        
        <h1 className="text-8xl md:text-9xl font-black text-gray-900 dark:text-white tracking-tight mb-6">
          404
        </h1>
        
        <p className="text-lg md:text-xl text-gray-600 dark:text-gray-400 mb-10 max-w-md leading-relaxed font-medium">
          {t.message}
        </p>
        
        <Link href={`/${lang}`} className="btn-primary">
          {t.btnText}
        </Link>

      </div>
    </main>
  );
}
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/components/search/SearchClient.tsx">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –ü–æ–∏—Å–∫ (Algolia) ===
"use client";

import { liteClient } from "algoliasearch/lite";
import { InstantSearch, useSearchBox, useHits, Configure } from "react-instantsearch";
import { Search } from "lucide-react";
import Link from "next/link";
import BookmarkButton from "@/components/ui/BookmarkButton";

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞ Algolia (–∏—Å–ø–æ–ª—å–∑—É–µ–º liteClient –¥–ª—è v5)
// –ï—Å–ª–∏ –∫–ª—é—á–µ–π –Ω–µ—Ç –≤ .env, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–∞–¥–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
const searchClient = liteClient(
  process.env.NEXT_PUBLIC_ALGOLIA_APP_ID || "APP_ID_MISSING",
  process.env.NEXT_PUBLIC_ALGOLIA_SEARCH_API_KEY || "API_KEY_MISSING"
);

// –ö–∞—Å—Ç–æ–º–Ω–æ–µ –ø–æ–ª–µ –≤–≤–æ–¥–∞ (SearchBox), —Å—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ø–æ–¥ –Ω–∞—à –¥–∏–∑–∞–π–Ω
function CustomSearchBox() {
  const { query, refine } = useSearchBox();

  return (
    <div className="relative w-full max-w-2xl mx-auto">
      <div className="absolute inset-y-0 left-0 flex items-center pl-7 pointer-events-none text-gray-400">
        <Search size={20} />
      </div>
      <input
        type="text"
        value={query}
        onChange={(e) => refine(e.target.value)}
        placeholder="–ù–∞–π—Ç–∏ —Å—Ç–∞—Ç—å—é, —Ç–µ–º—É –∏–ª–∏ –∞–≤—Ç–æ—Ä–∞..."
        className="w-full py-4 pl-14 pr-7 text-lg bg-gray-50 dark:bg-zinc-900 border border-gray-200 dark:border-zinc-800 text-gray-900 dark:text-white rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-sm transition-all"
      />
    </div>
  );
}

// –ö–∞—Å—Ç–æ–º–Ω—ã–π –≤—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (Hits)
function CustomHits() {
  const { hits } = useHits();

  if (hits.length === 0) {
    return (
      <div className="text-center py-10 text-gray-500 dark:text-zinc-500 font-medium">
        –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å.
      </div>
    );
  }

  return (
    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
      {hits.map((article: any) => (
        <Link
          href={`/post/${article.slug?.current || article.slug}`}
          key={article.objectID || article._id}
          className="flex flex-col justify-between p-5 bg-white dark:bg-[#0a0a0a] border border-gray-100 dark:border-zinc-800 rounded-2xl hover:border-gray-200 dark:hover:border-zinc-700 transition-colors"
        >
          <div>
            <h3 className="text-lg font-bold text-gray-900 dark:text-white tracking-tight mb-2">
              {article.title}
            </h3>
          </div>
          <div className="flex justify-between items-center mt-4">
            <span className="text-xs font-bold text-blue-600 uppercase tracking-wide">
              {article.category || "–°—Ç–∞—Ç—å—è"}
            </span>
            <div className="z-10" onClick={(e) => e.preventDefault()}>
              <BookmarkButton articleId={article.objectID || article._id} />
            </div>
          </div>
        </Link>
      ))}
    </div>
  );
}

interface SearchClientProps {
  initialArticles: any[]; // –û—Å—Ç–∞–≤–ª—è–µ–º –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏, –Ω–æ —Ç–µ–ø–µ—Ä—å –¥–∞–Ω–Ω—ã–µ —Ç—è–Ω–µ—Ç Algolia
}

export default function SearchClient({ initialArticles }: SearchClientProps) {
  // –ò–º—è –∏–Ω–¥–µ–∫—Å–∞ Algolia (—Å–æ–∑–¥–∞–π –µ–≥–æ –≤ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Algolia)
  const indexName = "posts_index"; 

  return (
    <div id="search-client-algolia" className="space-y-8">
      <InstantSearch searchClient={searchClient} indexName={indexName}>
        {/* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–∏—Å–∫–∞ (–∏—Å–∫–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ —ç—Ç–∏–º –ø–æ–ª—è–º) */}
        <Configure hitsPerPage={10} />
        
        <CustomSearchBox />
        
        <div>
          <h2 className="text-sm font-bold text-gray-400 uppercase tracking-wider mb-4 pl-2">
            –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
          </h2>
          <CustomHits />
        </div>
      </InstantSearch>
    </div>
  );
}
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/components/ui/BookmarkButton.tsx">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: –ö–Ω–æ–ø–∫–∞ –ó–∞–∫–ª–∞–¥–∫–∏ (–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è) ===
"use client";

import { useState, useEffect } from "react";
import { triggerHaptic } from "@/lib/haptic";

interface BookmarkButtonProps {
  articleId: string;
  className?: string;
}

export default function BookmarkButton({ articleId, className = "" }: BookmarkButtonProps) {
  const [isBookmarked, setIsBookmarked] = useState(false);
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    setMounted(true);
    
    // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    const checkStatus = () => {
      const saved = localStorage.getItem("bookmarkedArticles");
      if (saved) {
        const ids = JSON.parse(saved);
        setIsBookmarked(ids.includes(articleId));
      } else {
        setIsBookmarked(false);
      }
    };

    checkStatus();

    // 2. –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è (–µ—Å–ª–∏ —É–¥–∞–ª–∏–ª–∏ –∏–∑ –º–µ–Ω—é –∑–∞–∫–ª–∞–¥–æ–∫, –∫–Ω–æ–ø–∫–∞ –≤ –ª–µ–Ω—Ç–µ –¥–æ–ª–∂–Ω–∞ –æ—Ç–∂–∞—Ç—å—Å—è)
    const handleUpdate = () => checkStatus();
    
    window.addEventListener("bookmarksUpdated", handleUpdate);
    window.addEventListener("storage", handleUpdate);

    return () => {
      window.removeEventListener("bookmarksUpdated", handleUpdate);
      window.removeEventListener("storage", handleUpdate);
    };
  }, [articleId]);

  // –ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏–∏ (–ø—Ä—ã–∂–∫–∞ —Å—Ç–∏–ª–µ–π), –ø–æ–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è JS
  if (!mounted) {
    return (
       <div className={`p-2 rounded-full bg-gray-100 dark:bg-zinc-800 text-gray-400 opacity-50 ${className}`}>
         <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z"/></svg>
       </div>
    );
  }

  const handleClick = (e: React.MouseEvent) => {
    e.preventDefault();
    e.stopPropagation(); // –í–ê–ñ–ù–û: –ß—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ—Ö–æ–¥–∏–ª–æ –ø–æ —Å—Å—ã–ª–∫–µ —Å—Ç–∞—Ç—å–∏

    const saved = localStorage.getItem("bookmarkedArticles");
    let ids: string[] = saved ? JSON.parse(saved) : [];
    let newStatus = false;

    if (ids.includes(articleId)) {
      // –£–¥–∞–ª—è–µ–º
      ids = ids.filter((id) => id !== articleId);
      triggerHaptic("medium");
      newStatus = false;
    } else {
      // –î–æ–±–∞–≤–ª—è–µ–º
      ids.push(articleId);
      triggerHaptic("light");
      newStatus = true;
    }

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º
    localStorage.setItem("bookmarkedArticles", JSON.stringify(ids));
    setIsBookmarked(newStatus);

    // –£–≤–µ–¥–æ–º–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –∑–∞–∫–ª–∞–¥–æ–∫ –∏ –¥—Ä—É–≥–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
    window.dispatchEvent(new Event("bookmarksUpdated"));
  };

  return (
    <button
      onClick={handleClick}
      className={`p-2 rounded-full transition-colors duration-300 ${
        isBookmarked 
          ? "bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400" 
          : "bg-gray-100 dark:bg-zinc-800 text-gray-400 dark:text-zinc-500 hover:text-gray-900 dark:hover:text-white"
      } ${className}`}
      aria-label={isBookmarked ? "–£–¥–∞–ª–∏—Ç—å –∏–∑ –∑–∞–∫–ª–∞–¥–æ–∫" : "–î–æ–±–∞–≤–∏—Ç—å –≤ –∑–∞–∫–ª–∞–¥–∫–∏"}
    >
      <svg 
        xmlns="http://www.w3.org/2000/svg" 
        width="20" height="20" 
        viewBox="0 0 24 24" 
        fill={isBookmarked ? "currentColor" : "none"} 
        stroke="currentColor" 
        strokeWidth="2" 
        strokeLinecap="round" 
        strokeLinejoin="round"
      >
        <path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z"/>
      </svg>
    </button>
  );
}
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/components/ui/ProgressBar.tsx">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Reading Progress Bar ===
"use client";

import { useEffect, useState } from "react";

export default function ProgressBar() {
  const [readingProgress, setReadingProgress] = useState(0);

  useEffect(() => {
    const updateScroll = () => {
      const currentScrollY = window.scrollY;
      const scrollHeight = document.body.scrollHeight - window.innerHeight;
      
      if (scrollHeight) {
        setReadingProgress(Number((currentScrollY / scrollHeight).toFixed(2)) * 100);
      }
    };

    window.addEventListener("scroll", updateScroll, { passive: true });
    
    return () => window.removeEventListener("scroll", updateScroll);
  }, []);

  return (
    <div id="progress-bar-container" className="fixed top-0 left-0 w-full h-1.5 bg-gray-200 dark:bg-zinc-800 z-50 pointer-events-none">
      <div
        id="progress-bar-fill"
        className="h-full bg-blue-600 dark:bg-blue-500 transition-all duration-150 ease-out"
        style={{ width: `${readingProgress}%` }}
      />
    </div>
  );
}
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/components/ui/ThemeToggle.tsx">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Header Theme Toggle ===
"use client";

import { useTheme } from "next-themes";
import { useEffect, useState } from "react";

export function ThemeToggle() {
  const { theme, setTheme, systemTheme } = useTheme();
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    setMounted(true);
  }, []);

  if (!mounted) {
    return <div className="w-9 h-9 bg-gray-200 dark:bg-zinc-800 rounded-xl animate-pulse" />;
  }

  // –£—á–∏—Ç—ã–≤–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—É—é —Ç–µ–º—É
  const currentTheme = theme === "system" ? systemTheme : theme;

  return (
    <button
      onClick={() => setTheme(currentTheme === "dark" ? "light" : "dark")}
      className="p-2 rounded-xl bg-gray-100 dark:bg-zinc-800 text-gray-900 dark:text-white hover:bg-gray-200 dark:hover:bg-zinc-700 transition-colors flex items-center justify-center"
      aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É"
    >
      {currentTheme === "dark" ? (
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <circle cx="12" cy="12" r="4"/>
          <path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/>
        </svg>
      ) : (
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>
        </svg>
      )}
    </button>
  );
}
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/next.config.ts">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Next Config ===
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  images: {
    remotePatterns: [
      {
        protocol: "https",
        hostname: "cdn.sanity.io", // –†–∞–∑—Ä–µ—à–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫–∏ –∏–∑ Sanity
      },
    ],
  },
};

export default nextConfig;
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-admin/package.json">
{
  "name": "psy-admin",
  "private": true,
  "version": "1.0.0",
  "main": "package.json",
  "license": "UNLICENSED",
  "scripts": {
    "dev": "sanity dev",
    "start": "sanity start",
    "build": "sanity build",
    "deploy": "sanity deploy",
    "deploy-graphql": "sanity graphql deploy"
  },
  "keywords": [
    "sanity"
  ],
  "dependencies": {
    "@sanity/cli": "^5.10.0",
    "@sanity/document-internationalization": "^5.0.1",
    "@sanity/vision": "^5.10.0",
    "next-themes": "^0.4.6",
    "react": "^19.1",
    "react-dom": "^19.1",
    "sanity": "^5.10.0",
    "styled-components": "^6.1.18"
  },
  "devDependencies": {
    "@sanity/eslint-config-studio": "^6.0.0",
    "@types/react": "^19.1",
    "eslint": "^9.28",
    "prettier": "^3.5",
    "typescript": "^5.8"
  },
  "prettier": {
    "semi": false,
    "printWidth": 100,
    "bracketSpacing": false,
    "singleQuote": true
  }
}
</file>

<file path="psy-admin/sanity.cli.ts">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Sanity CLI Config ===
import {defineCliConfig} from 'sanity/cli'

export default defineCliConfig({
  api: {
    projectId: 'dp2yjc73', // üëà –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π Project ID
    dataset: 'production'
  },
  deployment: {
    appId: 'njvezevwrat8kpk3ahprsimp', // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ—Ç, —á—Ç–æ –≤—ã–¥–∞–ª —Ç–µ—Ä–º–∏–Ω–∞–ª
  }
})
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-admin/schemaTypes/blockContent.ts">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Block Content (Added YouTube) ===
import {defineType, defineArrayMember} from 'sanity'

export default defineType({
  title: 'Block Content',
  name: 'blockContent',
  type: 'array',
  of: [
    defineArrayMember({
      title: 'Block',
      type: 'block',
      styles: [
        {title: 'Normal', value: 'normal'},
        {title: 'H1', value: 'h1'},
        {title: 'H2', value: 'h2'},
        {title: 'H3', value: 'h3'},
        {title: 'H4', value: 'h4'},
        {title: 'Quote', value: 'blockquote'},
      ],
      lists: [{title: 'Bullet', value: 'bullet'}, {title: 'Number', value: 'number'}],
      marks: {
        decorators: [
          {title: 'Strong', value: 'strong'},
          {title: 'Emphasis', value: 'em'},
        ],
        annotations: [
          {
            title: 'URL',
            name: 'link',
            type: 'object',
            fields: [
              {
                title: 'URL',
                name: 'href',
                type: 'url',
              },
            ],
          },
        ],
      },
    }),
    defineArrayMember({
      type: 'image',
      options: {hotspot: true},
    }),
    // –í–ê–ñ–ù–û: –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É YouTube
    defineArrayMember({
      name: 'youtube',
      type: 'object',
      title: 'YouTube Video',
      fields: [
        {
          name: 'url',
          type: 'url',
          title: 'YouTube Video URL'
        }
      ]
    }),
  ],
})
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/app/[lang]/page.tsx">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Home Page (Strict Lang) ===
import { client } from "@/lib/sanity";
import { articlesQuery } from "@/lib/queries";
import SearchAndFeed from "@/components/feed/SearchAndFeed";

// –ö—ç—à–∏—Ä—É–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞ 60 —Å–µ–∫—É–Ω–¥
export const revalidate = 60; 

const translations = {
  ru: { h1: "–ü–æ–∑–Ω–∞–π —Å–µ–±—è.", sub: "–ù–∞—É—á–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏.", minRead: "–º–∏–Ω", err: "–£–ø—Å! –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞", errSub: "–ü—Ä–æ–≤–µ—Ä—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Sanity –∏–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ." },
  en: { h1: "Know yourself.", sub: "Scientific approach to psychology.", minRead: "min", err: "Oops! Database unavailable", errSub: "Check Sanity settings or connection." },
  ua: { h1: "–ü—ñ–∑–Ω–∞–π —Å–µ–±–µ.", sub: "–ù–∞—É–∫–æ–≤–∏–π –ø—ñ–¥—Ö—ñ–¥ –¥–æ –ø—Å–∏—Ö–æ–ª–æ–≥—ñ—ó.", minRead: "—Ö–≤", err: "–£–ø—Å! –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞", errSub: "–ü–µ—Ä–µ–≤—ñ—Ä –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Sanity –∞–±–æ –∑'—î–¥–Ω–∞–Ω–Ω—è." },
  pl: { h1: "Poznaj siebie.", sub: "Naukowe podej≈õcie do psychologii.", minRead: "min", err: "Ups! Baza danych niedostƒôpna", errSub: "Sprawd≈∫ ustawienia Sanity lub po≈ÇƒÖczenie." },
  de: { h1: "Erkenne dich selbst.", sub: "Wissenschaftlicher Ansatz zur Psychologie.", minRead: "Min", err: "Hoppla! Datenbank nicht verf√ºgbar", errSub: "Sanity-Einstellungen oder Verbindung pr√ºfen." },
};

interface Props {
  params: Promise<{ lang: string }>;
}

export default async function HomePage(props: Props) {
  // –í Next.js 15 params –Ω—É–∂–Ω–æ –∂–¥–∞—Ç—å (await)
  const params = await props.params;
  
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —è–∑—ã–∫ (fallback –Ω–∞ ru)
  const lang = (params.lang || "ru") as keyof typeof translations;
  const t = translations[lang] || translations.ru;

  let articles = [];
  let errorOccurred = false;

  try {
    // –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç—å–∏. –í –∑–∞–ø—Ä–æ—Å–µ articlesQuery —É–∂–µ –µ—Å—Ç—å –ª–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —è–∑—ã–∫—É.
    articles = await client.fetch(articlesQuery, { lang });
  } catch (error) {
    console.error("Sanity fetch error:", error);
    errorOccurred = true;
  }

  return (
    <main id="home-main">
      <div id="home-container" className="layout-container space-y-10">
        
        <section id="hero-section" className="space-y-6">
          <div className="space-y-2">
            <h1 className="text-4xl md:text-5xl font-black tracking-tight text-gray-900 dark:text-zinc-50">
              {t.h1}
            </h1>
            <p className="text-lg text-gray-600 dark:text-gray-400 font-medium">
              {t.sub}
            </p>
          </div>
        </section>

        {errorOccurred ? (
          <div id="error-state" className="p-10 border-2 border-dashed border-zinc-200 dark:border-zinc-800 rounded-3xl text-center">
            <p className="text-red-500 font-bold mb-2">{t.err}</p>
            <p className="text-sm text-gray-500">{t.errSub}</p>
          </div>
        ) : (
          /* –ü–µ—Ä–µ–¥–∞–µ–º lang –∏ minReadLabel –≤ SearchAndFeed */
          <SearchAndFeed initialArticles={articles} lang={lang} minReadLabel={t.minRead} />
        )}

      </div>
    </main>
  );
}
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/app/[lang]/search/page.tsx">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Search Input Component ===
"use client";

import { useState } from "react";
import { Search, X } from "lucide-react";

export default function SearchClient({ initialArticles }: any) {
  const [searchQuery, setSearchQuery] = useState("");

  return (
    <div className="w-full" id="search-interactive">
      <div className="relative w-full max-w-2xl mx-auto">
        {/* –ò–∫–æ–Ω–∫–∞ –ª—É–ø—ã (–æ—Ç—Å—Ç—É–ø 16px –æ—Ç –∫—Ä–∞—è) */}
        <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
        
        <input
          type="text"
          value={searchQuery}
          onChange={(e) => setSearchQuery(e.target.value)}
          placeholder="–ù–∞–π—Ç–∏ —Å—Ç–∞—Ç—å—é, —Ç–µ–≥ –∏–ª–∏ –∞–≤—Ç–æ—Ä–∞..."
          className="w-full py-4 pl-[44px] pr-[44px] bg-white dark:bg-[#0a0a0a] border border-gray-200 dark:border-zinc-800 rounded-[24px] text-[#111827] dark:text-[#f3f4f6] focus:outline-none focus:ring-2 focus:ring-blue-600 shadow-sm dark:shadow-none transition-all text-[16px] sm:text-[18px]"
        />
        
        {/* –ö—Ä–µ—Å—Ç–∏–∫ –æ—á–∏—Å—Ç–∫–∏ (—Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤ –∏–Ω–ø—É—Ç–µ –µ—Å—Ç—å —Ç–µ–∫—Å—Ç) */}
        {searchQuery && (
          <button
            onClick={() => setSearchQuery("")}
            className="absolute right-4 top-1/2 -translate-y-1/2 p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors"
            aria-label="–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫"
          >
            <X className="w-5 h-5" />
          </button>
        )}
      </div>

      {/* –ó–¥–µ—Å—å –Ω–∏–∂–µ —Ä–µ–Ω–¥–µ—Ä–∏—à—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ searchQuery */}
    </div>
  );
}
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/components/feed/ArticleCard.tsx">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Article Card (Final) ===
"use client";

import Link from "next/link";
import Image from "next/image";
import BookmarkButton from "@/components/ui/BookmarkButton";

// –°–ª–æ–≤–∞—Ä–∏
const TIME_LABELS: Record<string, string> = {
  ru: "–º–∏–Ω",
  en: "min",
  ua: "—Ö–≤",
  pl: "min",
  de: "Min",
};

const EXPERT_LABELS: Record<string, string> = {
  ru: "–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —ç–∫—Å–ø–µ—Ä—Ç–æ–º",
  en: "Verified by expert",
  ua: "–ü–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ –µ–∫—Å–ø–µ—Ä—Ç–æ–º",
  pl: "Sprawdzone przez eksperta",
  de: "Von Experten gepr√ºft",
};

const DEFAULT_CATEGORIES: Record<string, string> = {
  ru: "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è",
  en: "Psychology",
  ua: "–ü—Å–∏—Ö–æ–ª–æ–≥—ñ—è",
  pl: "Psychologia",
  de: "Psychologie",
};

interface ArticleCardProps {
  post: {
    _id: string;
    title: string;
    slug: string;
    category?: string;
    readTime?: number;
    expert?: boolean;
    mainImage?: string;
    language?: string;
  };
  lang?: string; // –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
}

export default function ArticleCard({ post, lang = "ru" }: ArticleCardProps) {
  // –õ–æ–≥–∏–∫–∞ —è–∑—ã–∫–∞
  const articleLang = post.language || lang || "ru";
  const timeLabel = TIME_LABELS[articleLang] || "min";
  const expertLabel = EXPERT_LABELS[articleLang] || "Expert";
  const defaultCategory = DEFAULT_CATEGORIES[articleLang] || "Psychology";

  return (
    <Link 
      href={`/${articleLang}/post/${post.slug}`} 
      className="group block outline-none h-full"
    >
      <article className="card-editorial h-full flex flex-col hover:translate-y-[-4px] transition-all duration-300">
        
        {/* –ö–∞—Ä—Ç–∏–Ω–∫–∞ */}
        <div className="relative w-full aspect-[4/3] rounded-2xl bg-gray-100 dark:bg-zinc-800 mb-5 overflow-hidden shadow-sm">
          {post.mainImage ? (
            <Image 
              src={post.mainImage} 
              alt={post.title}
              fill
              sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
              className="object-cover group-hover:scale-105 transition-transform duration-500" 
            />
          ) : (
            <div className="absolute inset-0 bg-gradient-to-tr from-blue-50 to-indigo-50 dark:from-zinc-800 dark:to-zinc-900 flex items-center justify-center">
                <span className="text-gray-300 dark:text-zinc-700 font-bold text-4xl opacity-20">PSY</span>
            </div>
          )}
        </div>

        {/* –¢–µ–∫—Å—Ç–æ–≤–∞—è —á–∞—Å—Ç—å */}
        <div className="flex flex-col flex-1">
          {/* justify-between + items-start + gap-3 
             –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —Ç–µ–∫—Å—Ç –Ω–µ –Ω–∞–µ–¥–µ—Ç –Ω–∞ –∫–Ω–æ–ø–∫—É 
          */}
          <div className="flex items-start justify-between mb-3 gap-3">
            
            <div className="flex flex-wrap items-center gap-2 text-xs font-bold uppercase tracking-wider mt-1.5">
              <span className="text-blue-600 dark:text-blue-400 whitespace-nowrap">
                {post.category || defaultCategory}
              </span>
              <span className="text-gray-300 dark:text-zinc-700">‚Ä¢</span>
              <span className="text-gray-500 whitespace-nowrap">
                {post.readTime || 5} {timeLabel}
              </span>
            </div>
            
            {/* z-10 –ø–æ–¥–Ω–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É –Ω–∞–¥ —Å—Å—ã–ª–∫–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ */}
            <div className="z-10 relative flex-shrink-0" onClick={(e) => e.preventDefault()}>
                <BookmarkButton articleId={post._id} />
            </div>
          </div>

          <h3 className="text-xl font-extrabold text-gray-900 dark:text-white leading-snug mb-3 group-hover:text-blue-600 transition-colors line-clamp-2">
            {post.title}
          </h3>

          {post.expert && (
            <div className="mt-auto pt-3 flex items-center gap-2">
                <span className="text-xs font-semibold text-green-600 bg-green-50 dark:bg-green-900/20 px-2 py-1 rounded-full">
                  ‚úì {expertLabel}
                </span>
            </div>
          )}
        </div>
      </article>
    </Link>
  );
}
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/components/ui/BottomBar.tsx">
"use client";

import Link from "next/link";
import { usePathname } from "next/navigation";
import { triggerHaptic } from "@/lib/haptic";

const translations = {
  ru: { home: "–ì–ª–∞–≤–Ω–∞—è", fav: "–ò–∑–±—Ä–∞–Ω–Ω–æ–µ", menu: "–ú–µ–Ω—é" },
  en: { home: "Home", fav: "Bookmarks", menu: "Menu" },
  ua: { home: "–ì–æ–ª–æ–≤–Ω–∞", fav: "–û–±—Ä–∞–Ω–µ", menu: "–ú–µ–Ω—é" },
  pl: { home: "G≈Ç√≥wna", fav: "Zak≈Çadki", menu: "Menu" },
  de: { home: "Home", fav: "Favoriten", menu: "Men√º" },
};

export default function BottomBar() {
  const pathname = usePathname();
  const currentLang = (pathname?.split("/")[1] || "ru") as keyof typeof translations;
  const t = translations[currentLang] || translations.ru;

  const isActive = (path: string) => {
    if (path === `/${currentLang}`) {
      return pathname === `/${currentLang}` || pathname === `/${currentLang}/`;
    }
    return pathname?.startsWith(path);
  };

  return (
    <nav id="mobile-bottom-bar" className="md:hidden fixed bottom-0 left-0 right-0 z-50 bg-white/80 dark:bg-[#0a0a0a]/80 backdrop-blur-lg border-t border-gray-100 dark:border-zinc-800 pb-[env(safe-area-inset-bottom)]">
      <div className="flex items-center justify-around h-16 px-4">
        
        <Link 
          href={`/${currentLang}`} 
          onClick={() => triggerHaptic('light')}
          className={`flex flex-col items-center justify-center w-full h-full space-y-1 transition-colors ${isActive(`/${currentLang}`) ? 'text-blue-600 dark:text-blue-400' : 'text-gray-400 dark:text-gray-500'}`}
        >
          <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
          </svg>
          <span className="text-[10px] font-bold">{t.home}</span>
        </Link>

        <Link 
          href={`/${currentLang}/bookmarks`} 
          onClick={() => triggerHaptic('light')}
          className={`flex flex-col items-center justify-center w-full h-full space-y-1 transition-colors ${isActive(`/${currentLang}/bookmarks`) ? 'text-blue-600 dark:text-blue-400' : 'text-gray-400 dark:text-gray-500'}`}
        >
          <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z" />
          </svg>
          <span className="text-[10px] font-bold">{t.fav}</span>
        </Link>

        <Link 
          href={`/${currentLang}/menu`} 
          onClick={() => triggerHaptic('light')}
          className={`flex flex-col items-center justify-center w-full h-full space-y-1 transition-colors ${isActive(`/${currentLang}/menu`) ? 'text-blue-600 dark:text-blue-400' : 'text-gray-400 dark:text-gray-500'}`}
        >
          <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
          <span className="text-[10px] font-bold">{t.menu}</span>
        </Link>

      </div>
    </nav>
  );
}
</file>

<file path="psy-front/components/ui/Header.tsx">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Header ===
"use client";

import Link from "next/link";
import { usePathname } from "next/navigation";
import { ThemeToggle } from "./ThemeToggle"; 
import LanguageSwitcher from "../LanguageSwitcher";

const translations = {
  ru: { bookmarks: "–ó–∞–∫–ª–∞–¥–∫–∏" },
  en: { bookmarks: "Bookmarks" },
  ua: { bookmarks: "–ó–∞–∫–ª–∞–¥–∫–∏" },
  pl: { bookmarks: "Zak≈Çadki" },
  de: { bookmarks: "Lesezeichen" },
};

export default function Header() {
  const pathname = usePathname();
  const lang = (pathname?.split("/")[1] || "ru") as keyof typeof translations;
  // –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–∞–¥–µ–Ω–∏—è, –µ—Å–ª–∏ —è–∑—ã–∫ –≤ URL –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
  const t = translations[lang as keyof typeof translations] || translations.ru;

  return (
    <header id="desktop-header" className="fixed top-0 left-0 right-0 z-50 bg-background/80 backdrop-blur-md border-b border-gray-200 dark:border-zinc-800 hidden md:flex items-center h-16">
      <div className="layout-container flex items-center justify-between w-full">
        
        <Link href={`/${lang}`} className="text-xl font-black tracking-tighter text-foreground">
          HEALTH<span className="text-blue-600 font-normal">PSY</span>
        </Link>

        <nav className="flex items-center gap-6 text-sm font-bold text-gray-600 dark:text-gray-300">
          {/* –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–∏—Å–∫ —É–¥–∞–ª–µ–Ω–∞ */}
          
          <Link href={`/${lang}/bookmarks`} className="hover:text-blue-600 transition-colors">
            {t.bookmarks}
          </Link>
          
          <div className="border-l border-gray-300 dark:border-zinc-700 pl-6 flex items-center gap-4">
            <LanguageSwitcher />
            <ThemeToggle />
          </div>
        </nav>
        
      </div>
    </header>
  );
}
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-admin/sanity.config.ts">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Sanity Config Admin ===
import {defineConfig} from 'sanity'
import {structureTool} from 'sanity/structure'
import {visionTool} from '@sanity/vision'
import {schemaTypes} from './schemaTypes'
import {documentInternationalization} from '@sanity/document-internationalization'

export default defineConfig({
  name: 'default',
  title: 'Health Psy CMS',
  projectId: process.env.SANITY_STUDIO_PROJECT_ID || 'dp2yjc73',
  dataset: process.env.SANITY_STUDIO_DATASET || 'production',

  plugins: [
    // üëá –î–û–ë–ê–í–õ–ï–ù–û: –ö–∞—Å—Ç–æ–º–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, —Å–∫—Ä—ã–≤–∞—é—â–∞—è Translation Metadata
    structureTool({
      structure: (S) =>
        S.list()
          .title('Content')
          .items([
            ...S.documentTypeListItems().filter(
              (listItem) => listItem.getId() !== 'translation.metadata'
            ),
          ]),
    }),
    visionTool(),
    documentInternationalization({
      supportedLanguages: [
        {id: 'ru', title: '–†—É—Å—Å–∫–∏–π'},
        {id: 'en', title: 'English'},
        {id: 'ua', title: '–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞'},
        {id: 'pl', title: 'Polski'},
        {id: 'de', title: 'Deutsch'}
      ],
      schemaTypes: ['post'],
      languageField: 'language',
    })
  ],

  schema: {
    types: schemaTypes,
  },
})
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/app/globals.css">
@import "tailwindcss";

@custom-variant dark (&:where(.dark, .dark *));

/* –í v4 –ø–ª–∞–≥–∏–Ω—ã –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ @plugin, –Ω–æ typography —á–∞—Å—Ç–æ –∏–¥–µ—Ç –≤ –∫–æ–º–ø–ª–µ–∫—Ç–µ –∏–ª–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∏–Ω–∞—á–µ. 
–ï—Å–ª–∏ @plugin —Ä—É–≥–∞–µ—Ç—Å—è, —É–±–µ–¥–∏—Å—å, —á—Ç–æ –ø–∞–∫–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: npm install @tailwindcss/typography */
@plugin "@tailwindcss/typography";

/* –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º—ã –≤ v4 —Ç–µ–ø–µ—Ä—å –¥–µ–ª–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ @theme */
@theme {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
}

:root {
  --background: #ffffff;
  --foreground: #111827;
}

.dark {
  --background: #0a0a0a;
  --foreground: #f3f4f6;
}

/* –í–º–µ—Å—Ç–æ @custom-variant –≤ v4 –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–º—ã */

@layer base {
  body {
    background-color: var(--background);
    color: var(--foreground);
    @apply transition-colors duration-500 ease-in-out antialiased;
  }
}

@layer components {
  /* –¢–≤–æ–∏ —Å—Ç–∏–ª–∏ –∫–Ω–æ–ø–æ–∫ –∏ –∫–∞—Ä—Ç–æ—á–µ–∫ –Ω–∏–∂–µ... */
  .btn-primary { @apply inline-flex items-center justify-center px-[32px] py-[16px] bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-2xl transition-all duration-300 shadow-sm active:scale-95; }
  .btn-secondary { @apply inline-flex items-center justify-center px-[32px] py-[16px] bg-gray-100 dark:bg-zinc-800 text-gray-900 dark:text-white font-bold rounded-2xl transition-all duration-300 active:scale-95 hover:bg-gray-200 dark:hover:bg-zinc-700; }
  .tag-pill { @apply inline-flex items-center justify-center px-[24px] py-[12px] bg-white dark:bg-zinc-900 text-gray-700 dark:text-zinc-300 text-sm font-bold rounded-full border border-gray-200 dark:border-zinc-800 hover:border-blue-500 hover:text-blue-600 dark:hover:text-blue-400 transition-all duration-300 active:scale-95 shadow-sm; }
  .input-base { @apply w-full px-[28px] py-[16px] bg-gray-50 dark:bg-zinc-900 border-none ring-1 ring-gray-200 dark:ring-zinc-800 focus:ring-2 focus:ring-blue-500 rounded-[24px] text-gray-900 dark:text-white placeholder-gray-500 transition-all duration-300 outline-none; }
  .card-editorial { @apply p-[24px] bg-white dark:bg-zinc-900 rounded-[24px] border border-gray-100 dark:border-zinc-800 shadow-sm dark:shadow-none transition-all duration-300; }
  .layout-container { @apply max-w-3xl mx-auto px-4 sm:px-6 w-full; }
  }

/* –ö–∞—Å—Ç–æ–º–Ω—ã–π —Å–∫—Ä–æ–ª–ª–±–∞—Ä */
@layer utilities {
  /* –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–∫—Ä–æ–ª–ª–±–∞—Ä –¥–ª—è Firefox */
  .custom-scrollbar {
    scrollbar-width: thin;
    scrollbar-color: #d4d4d8 transparent;
  }

  .dark .custom-scrollbar {
    scrollbar-color: #3f3f46 transparent;
  }

  /* –ö–∞—Å—Ç–æ–º–Ω—ã–π —Å–∫—Ä–æ–ª–ª–±–∞—Ä –¥–ª—è Chrome, Safari, Edge */
  .custom-scrollbar::-webkit-scrollbar {
    height: 4px; /* –î–µ–ª–∞–µ–º –µ–≥–æ –µ—â–µ —Ç–æ–Ω—å—à–µ */
  }

  .custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: #e4e4e7; /* –û—á–µ–Ω—å —Å–≤–µ—Ç–ª—ã–π —Å–µ—Ä—ã–π (zinc-200) */
    border-radius: 9999px; /* –ò–¥–µ–∞–ª—å–Ω–æ –∫—Ä—É–≥–ª—ã–π */
  }

  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background-color: #a1a1aa; /* –ß—É—Ç—å —Ç–µ–º–Ω–µ–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ (zinc-400) */
  }

  /* –°—Ç–∏–ª–∏ —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã –≤ WebKit */
  .dark .custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: #27272a; /* –¢–µ–º–Ω–æ-—Å–µ—Ä—ã–π (zinc-800) */
  }

  .dark .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background-color: #52525b; /* –°–≤–µ—Ç–ª–µ–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ (zinc-600) */
  }
}
</file>

<file path="psy-front/components/feed/SearchAndFeed.tsx">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Feed with Inline Search ===
"use client";

import { useState, useEffect } from "react";
import Link from "next/link";
import Image from "next/image";
import { Search, X } from "lucide-react"; 
import BookmarkButton from "@/components/ui/BookmarkButton";

interface Article {
  _id: string;
  title: string;
  slug: string;
  category: string;
  readTime: number;
  expert: boolean;
  mainImage: string;
}

interface SearchAndFeedProps {
  initialArticles: Article[];
  lang: string; 
  minReadLabel: string; // –ü—Ä–∏–Ω–∏–º–∞–µ–º –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω–æ–µ —Å–ª–æ–≤–æ "–º–∏–Ω"
}

// –°–ª–æ–≤–∞—Ä–∏ –¥–ª—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
const componentTranslations = {
  ru: {
    placeholder: "–ù–∞–π—Ç–∏ —Å—Ç–∞—Ç—å—é, —Ç–µ–º—É –∏–ª–∏ –∞–≤—Ç–æ—Ä–∞...",
    resultsFor: "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞",
    latest: "–°–≤–µ–∂–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã",
    notFound: "–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É",
    verified: "–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —ç–∫—Å–ø–µ—Ä—Ç–æ–º",
    categoryDefault: "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è",
    tags: ["–¢–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å", "–õ–∏—á–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã", "–¢—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å", "–°—Ç—Ä–µ—Å—Å", "–ü—Ä–∏–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å"]
  },
  en: {
    placeholder: "Search for article, topic or author...",
    resultsFor: "Search results",
    latest: "Latest articles",
    notFound: "Nothing found for",
    verified: "Verified by expert",
    categoryDefault: "Psychology",
    tags: ["Toxicity", "Boundaries", "Anxiety", "Stress", "Attachment"]
  },
  ua: {
    placeholder: "–ó–Ω–∞–π—Ç–∏ —Å—Ç–∞—Ç—Ç—é, —Ç–µ–º—É –∞–±–æ –∞–≤—Ç–æ—Ä–∞...",
    resultsFor: "–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ—à—É–∫—É",
    latest: "–°–≤—ñ–∂—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏",
    notFound: "–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∑–∞ –∑–∞–ø–∏—Ç–æ–º",
    verified: "–ü–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ –µ–∫—Å–ø–µ—Ä—Ç–æ–º",
    categoryDefault: "–ü—Å–∏—Ö–æ–ª–æ–≥—ñ—è",
    tags: ["–¢–æ–∫—Å–∏—á–Ω—ñ—Å—Ç—å", "–û—Å–æ–±–∏—Å—Ç—ñ –∫–æ—Ä–¥–æ–Ω–∏", "–¢—Ä–∏–≤–æ–∂–Ω—ñ—Å—Ç—å", "–°—Ç—Ä–µ—Å", "–ü—Ä–∏—Ö–∏–ª—å–Ω—ñ—Å—Ç—å"]
  },
  pl: {
    placeholder: "Szukaj artyku≈Çu, tematu lub autora...",
    resultsFor: "Wyniki wyszukiwania",
    latest: "Najnowsze artyku≈Çy",
    notFound: "Nic nie znaleziono dla",
    verified: "Sprawdzone przez eksperta",
    categoryDefault: "Psychologia",
    tags: ["Toksyczno≈õƒá", "Granice", "Lƒôk", "Stres", "PrzywiƒÖzanie"]
  },
  de: {
    placeholder: "Artikel, Thema oder Autor suchen...",
    resultsFor: "Suchergebnisse",
    latest: "Neueste Artikel",
    notFound: "Nichts gefunden f√ºr",
    verified: "Von Experten gepr√ºft",
    categoryDefault: "Psychologie",
    tags: ["Toxizit√§t", "Grenzen", "Angst", "Stress", "Bindung"]
  }
};

export default function SearchAndFeed({ initialArticles, lang, minReadLabel }: SearchAndFeedProps) {
  const [query, setQuery] = useState("");
  const [debouncedQuery, setDebouncedQuery] = useState("");
  const [results, setResults] = useState<Article[]>(initialArticles);

  const t = componentTranslations[lang as keyof typeof componentTranslations] || componentTranslations.ru;
  const currentTags = t.tags;

  useEffect(() => {
    const timer = setTimeout(() => {
      setDebouncedQuery(query);
    }, 300);
    return () => clearTimeout(timer);
  }, [query]);

  useEffect(() => {
    if (!debouncedQuery.trim()) {
      setResults(initialArticles);
      return;
    }
    
    const lowerQuery = debouncedQuery.toLowerCase();
    const filtered = initialArticles.filter((article) => 
      article.title.toLowerCase().includes(lowerQuery) || 
      (article.category && article.category.toLowerCase().includes(lowerQuery))
    );
    
    setResults(filtered);
  }, [debouncedQuery, initialArticles]);

  return (
    <div className="space-y-10">
      
      {/* 1. –ë–ª–æ–∫ –ü–æ–∏—Å–∫–∞ –∏ –¢–µ–≥–æ–≤ */}
      <section id="search-section" className="space-y-6">
        <div className="relative w-full max-w-2xl mx-auto">
          <div className="absolute inset-y-0 left-0 flex items-center pl-5 pointer-events-none text-gray-400">
            <Search size={20} />
          </div>
          
          <input
            type="text"
            value={query}
            onChange={(e) => setQuery(e.target.value)}
            placeholder={t.placeholder}
            className="w-full py-4 pl-12 pr-12 text-lg bg-white dark:bg-zinc-900 border border-gray-200 dark:border-zinc-800 text-gray-900 dark:text-white rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-sm transition-all placeholder:text-gray-400"
          />

          {query && (
            <button
              onClick={() => setQuery("")}
              className="absolute inset-y-0 right-3 flex items-center p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors"
              aria-label="–û—á–∏—Å—Ç–∏—Ç—å"
            >
              <X size={20} />
            </button>
          )}
        </div>

        <div id="tags-carousel" className="flex gap-3 overflow-x-auto pb-4 custom-scrollbar snap-x snap-mandatory scroll-smooth w-full px-1">
          {currentTags.map((tag) => (
            <button 
              key={tag} 
              onClick={() => setQuery(tag)} 
              className={`tag-pill whitespace-nowrap snap-center cursor-pointer transition-colors px-4 py-2 rounded-full border text-sm font-medium ${
                query.toLowerCase() === tag.toLowerCase() 
                  ? 'bg-blue-600 text-white border-blue-600 dark:bg-blue-600 dark:text-white' 
                  : 'bg-white dark:bg-zinc-800 border-gray-200 dark:border-zinc-700 text-gray-700 dark:text-gray-300 hover:border-blue-300 dark:hover:border-blue-700'
              }`}
            >
              #{tag}
            </button>
          ))}
        </div>
      </section>

      {/* 2. –õ–µ–Ω—Ç–∞ –°—Ç–∞—Ç–µ–π (–†–µ–∑—É–ª—å—Ç–∞—Ç—ã) */}
      <section id="latest-articles" className="space-y-8">
        <h2 className="text-2xl font-extrabold text-gray-900 dark:text-zinc-50 tracking-tight">
          {query ? `${t.resultsFor} (${results.length})` : t.latest}
        </h2>

        {results.length === 0 ? (
          <div className="text-center py-16 text-gray-500 dark:text-zinc-500 font-medium bg-gray-50 dark:bg-zinc-900/50 rounded-3xl border border-dashed border-gray-200 dark:border-zinc-800">
            <p className="mb-2">{t.notFound} ¬´{query}¬ª</p>
            <button onClick={() => setQuery("")} className="text-blue-600 hover:underline">
              {lang === 'en' ? 'Clear search' : '–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫'}
            </button>
          </div>
        ) : (
          <div id="articles-grid" className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {results.map((article, index) => (
              <Link key={article._id} href={`/${lang}/post/${article.slug}`} className="group block outline-none h-full">
                <article className="card-editorial h-full flex flex-col hover:translate-y-[-4px] transition-all duration-300">
                  
                  <div className="relative w-full aspect-[4/3] rounded-2xl bg-gray-100 dark:bg-zinc-800 mb-5 overflow-hidden shadow-sm">
                    {article.mainImage ? (
                      <Image 
                        src={article.mainImage} 
                        alt={article.title}
                        fill
                        sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
                        priority={index < 2 && !query}
                        className="object-cover group-hover:scale-105 transition-transform duration-500" 
                      />
                    ) : (
                      <div className="absolute inset-0 bg-gradient-to-tr from-blue-50 to-indigo-50 dark:from-zinc-800 dark:to-zinc-900 flex items-center justify-center">
                         <span className="text-gray-300 dark:text-zinc-700 font-bold text-4xl opacity-20">PSY</span>
                      </div>
                    )}
                  </div>

                  <div className="flex flex-col flex-1">
                    {/* üëá –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–¢–ö–ê: min-w-0, shrink-0, whitespace-nowrap üëá */}
                    <div className="flex items-start justify-between mb-3 gap-2">
                      <div className="flex items-center gap-2 text-xs font-bold uppercase tracking-wider min-w-0">
                        <span className="text-blue-600 dark:text-blue-400 truncate">{article.category || t.categoryDefault}</span>
                        <span className="text-gray-300 dark:text-zinc-700 shrink-0">‚Ä¢</span>
                        {/* whitespace-nowrap –Ω–µ –¥–∞–µ—Ç —Ü–∏—Ñ—Ä–∞–º –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏—Å—å –Ω–∞ –¥—Ä—É–≥—É—é —Å—Ç—Ä–æ–∫—É –æ—Ç —Ç–µ–∫—Å—Ç–∞ */}
                        <span className="text-gray-500 shrink-0 whitespace-nowrap">{article.readTime || 5} {minReadLabel}</span>
                      </div>
                      
                      {/* shrink-0 –∑–∞–ø—Ä–µ—â–∞–µ—Ç –∫–Ω–æ–ø–∫–µ –∑–∞–∫–ª–∞–¥–æ–∫ —Å–∂–∏–º–∞—Ç—å—Å—è –∏ —É–ª–µ—Ç–∞—Ç—å */}
                      <div className="z-10 relative shrink-0" onClick={(e) => e.preventDefault()}>
                         <BookmarkButton articleId={article._id} />
                      </div>
                    </div>

                    <h3 className="text-xl font-extrabold text-gray-900 dark:text-white leading-snug mb-3 group-hover:text-blue-600 transition-colors line-clamp-2">
                      {article.title}
                    </h3>

                    {article.expert && (
                      <div className="mt-auto pt-3 flex items-center gap-2">
                         <span className="text-xs font-semibold text-green-600 bg-green-50 dark:bg-green-900/20 px-2 py-1 rounded-full whitespace-nowrap">
                           ‚úì {t.verified}
                         </span>
                      </div>
                    )}
                  </div>
                </article>
              </Link>
            ))}
          </div>
        )}
      </section>

    </div>
  );
}
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/components/article/ArticleActions.tsx">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Article Actions (Audio & Share) ===
"use client";

import { useState, useEffect, useRef } from "react";
import { triggerHaptic } from "@/lib/haptic";

interface ArticleActionsProps {
  title: string;
  textToRead: string;
  lang?: string;
}

const translations = {
  ru: { listen: "üéß –°–ª—É—à–∞—Ç—å —Å—Ç–∞—Ç—å—é", stop: "‚èπ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å", share: "‚Üó –ü–æ–¥–µ–ª–∏—Ç—å—Å—è", copied: "–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!", recommend: "–†–µ–∫–æ–º–µ–Ω–¥—É—é –ø—Ä–æ—á–∏—Ç–∞—Ç—å —ç—Ç—É —Å—Ç–∞—Ç—å—é: ", error: "–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ-—á—Ç–µ–Ω–∏–µ." },
  en: { listen: "üéß Listen to article", stop: "‚èπ Stop", share: "‚Üó Share", copied: "Link copied!", recommend: "I recommend reading this article: ", error: "Your browser does not support audio reading." },
  ua: { listen: "üéß –°–ª—É—Ö–∞—Ç–∏ —Å—Ç–∞—Ç—Ç—é", stop: "‚èπ –ó—É–ø–∏–Ω–∏—Ç–∏", share: "‚Üó –ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è", copied: "–ü–æ—Å–∏–ª–∞–Ω–Ω—è —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!", recommend: "–†–µ–∫–æ–º–µ–Ω–¥—É—é –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ —Ü—é —Å—Ç–∞—Ç—Ç—é: ", error: "–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –∞—É–¥—ñ–æ-—á–∏—Ç–∞–Ω–Ω—è." },
  pl: { listen: "üéß Pos≈Çuchaj artyku≈Çu", stop: "‚èπ Zatrzymaj", share: "‚Üó Udostƒôpnij", copied: "Link skopiowany!", recommend: "Polecam przeczytaƒá ten artyku≈Ç: ", error: "Twoja przeglƒÖdarka nie obs≈Çuguje czytania audio." },
  de: { listen: "üéß Artikel anh√∂ren", stop: "‚èπ Stoppen", share: "‚Üó Teilen", copied: "Link kopiert!", recommend: "Ich empfehle diesen Artikel zu lesen: ", error: "Ihr Browser unterst√ºtzt kein Audio-Lesen." },
};

export default function ArticleActions({ title, textToRead, lang = "ru" }: ArticleActionsProps) {
  const [isPlaying, setIsPlaying] = useState(false);
  const [url, setUrl] = useState("");
  const isComponentMounted = useRef(true);
  
  const t = translations[lang as keyof typeof translations] || translations.ru;

  useEffect(() => {
    setUrl(window.location.href);
    isComponentMounted.current = true;
    
    // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞–µ–º –≥–æ–ª–æ—Å–∞, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–∞—É–∑—ã –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–ª–∏–∫–µ
    if (typeof window !== "undefined" && window.speechSynthesis) {
      window.speechSynthesis.getVoices();
    }
    
    // –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    return () => {
      isComponentMounted.current = false;
      if (typeof window !== "undefined" && window.speechSynthesis) {
        window.speechSynthesis.cancel();
      }
    };
  }, []);

  const handleShare = async () => {
    triggerHaptic('medium'); 
    
    if (typeof navigator !== "undefined" && navigator.share) {
      try {
        await navigator.share({
          title: title,
          text: t.recommend + title,
          url: url,
        });
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ —à–∞—Ä–∏–Ω–≥–∞:", error);
      }
    } else if (typeof navigator !== "undefined" && navigator.clipboard && window.isSecureContext) {
      try {
        await navigator.clipboard.writeText(url);
        alert(t.copied);
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:", error);
      }
    } else {
      try {
        const textArea = document.createElement("textarea");
        textArea.value = url;
        textArea.style.position = "absolute";
        textArea.style.left = "-999999px";
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        document.execCommand('copy');
        textArea.remove();
        alert(t.copied);
      } catch (error) {
        alert(`–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –≤—Ä—É—á–Ω—É—é:\n\n${url}`);
      }
    }
  };

  const handleAudio = () => {
    triggerHaptic('light');
    
    if (typeof window !== "undefined" && !window.speechSynthesis) {
      alert(t.error);
      return;
    }

    if (isPlaying) {
      window.speechSynthesis.cancel();
      setIsPlaying(false);
    } else {
      // –°–Ω–∞—á–∞–ª–∞ –≤—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–µ–º cancel, —á—Ç–æ–±—ã —Å–±—Ä–æ—Å–∏—Ç—å –∑–∞–≤–∏—Å—à–∏–µ –æ—á–µ—Ä–µ–¥–∏ –±—Ä–∞—É–∑–µ—Ä–∞
      window.speechSynthesis.cancel();
      
      const utterance = new SpeechSynthesisUtterance(textToRead);
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —è–∑—ã–∫
      const langCode = lang === 'ua' ? 'uk-UA' : lang === 'pl' ? 'pl-PL' : lang === 'de' ? 'de-DE' : lang === 'en' ? 'en-US' : 'ru-RU';
      utterance.lang = langCode;
      
      // –ü–æ–∏—Å–∫ –ª—É—á—à–µ–≥–æ –≥–æ–ª–æ—Å–∞ (Google, Microsoft Premium, Natural)
      const voices = window.speechSynthesis.getVoices();
      if (voices.length > 0) {
        const matchingVoices = voices.filter(v => v.lang.includes(langCode.split('-')[0]));
        
        const bestVoice = matchingVoices.find(v => 
          v.name.includes("Natural") || 
          v.name.includes("Premium") || 
          v.name.includes("Google") ||
          v.name.includes("Microsoft online")
        );

        if (bestVoice) {
          utterance.voice = bestVoice;
        } else if (matchingVoices.length > 0) {
          utterance.voice = matchingVoices[0];
        }
      }

      utterance.rate = 1.05; // –ß—É—Ç—å –±—ã—Å—Ç—Ä–µ–µ –¥–ª—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
      
      utterance.onend = () => {
        if (isComponentMounted.current) setIsPlaying(false);
      };
      
      utterance.onerror = () => {
        if (isComponentMounted.current) setIsPlaying(false);
      };
      
      window.speechSynthesis.speak(utterance);
      setIsPlaying(true);
    }
  };

  return (
    <div id="article-interactive-actions" className="flex flex-col sm:flex-row items-center gap-4 my-10 border-y border-gray-100 dark:border-zinc-800 py-6">
      <button onClick={handleAudio} className="btn-secondary w-full sm:w-1/2">
        {isPlaying ? t.stop : t.listen}
      </button>
      <button onClick={handleShare} className="btn-primary w-full sm:w-1/2">
        {t.share}
      </button>
    </div>
  );
}
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/components/LanguageSwitcher.tsx">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Smart Language Switcher (Localized) ===
"use client";

import { usePathname, useRouter } from "next/navigation";
import { client } from "@/lib/sanity";
import { useToast } from "@/components/ui/ToastProvider";
import { useState } from "react";

// –°–ª–æ–≤–∞—Ä—å —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å—Ç–∞—Ç—å–∏ –Ω–∞ —Ü–µ–ª–µ–≤–æ–º —è–∑—ã–∫–µ
const NO_ARTICLE_MESSAGES: Record<string, string> = {
  ru: "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —ç—Ç–∞ —Å—Ç–∞—Ç—å—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.",
  en: "Sorry, this article is not available in English.",
  ua: "–ù–∞ –∂–∞–ª—å, —Ü—è —Å—Ç–∞—Ç—Ç—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é.",
  pl: "Niestety, ten artyku≈Ç nie jest dostƒôpny w jƒôzyku polskim.",
  de: "Leider ist dieser Artikel nicht auf Deutsch verf√ºgbar."
};

export default function LanguageSwitcher() {
  const pathname = usePathname();
  const router = useRouter();
  const { showToast } = useToast();
  const [isLoading, setIsLoading] = useState(false);

  const languages = [
    { code: "ru", label: "RU" },
    { code: "en", label: "EN" },
    { code: "ua", label: "UA" },
    { code: "pl", label: "PL" },
    { code: "de", label: "DE" },
  ];

  const handleLanguageChange = async (targetLangCode: string) => {
    if (!pathname) return;
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —è–∑—ã–∫ –∏–∑ URL (–ø–µ—Ä–≤—ã–π —Å–µ–≥–º–µ–Ω—Ç –ø—É—Ç–∏)
    const segments = pathname.split("/").filter(Boolean);
    const currentLangCode = languages.some(l => l.code === segments[0]) ? segments[0] : "ru";

    // –ï—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –Ω–∞ —Ç–æ—Ç –∂–µ —è–∑—ã–∫ ‚Äî –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
    if (targetLangCode === currentLangCode) return;

    setIsLoading(true);

    try {
      // 1. –ü–†–û–í–ï–†–ö–ê: –ù–∞—Ö–æ–¥–∏–º—Å—è –ª–∏ –º—ã –≤–Ω—É—Ç—Ä–∏ —Å—Ç–∞—Ç—å–∏?
      // URL —Å—Ç–∞—Ç—å–∏ –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ /ru/post/some-slug
      const isPostPage = segments.length >= 2 && segments[1] === "post";
      const currentSlug = segments[2]; 

      if (isPostPage && currentSlug) {
        // –ó–∞–ø—Ä–æ—Å –≤ Sanity: –µ—Å—Ç—å –ª–∏ —Å—Ç–∞—Ç—å—è —Å —Ç–∞–∫–∏–º slug –Ω–∞ –Ω–æ–≤–æ–º —è–∑—ã–∫–µ?
        const query = `count(*[_type == "post" && slug.current == $slug && language == $lang])`;
        const exists = await client.fetch(query, { slug: currentSlug, lang: targetLangCode });

        if (exists > 0) {
          // –£–†–ê: –°—Ç–∞—Ç—å—è –µ—Å—Ç—å! –ü–µ—Ä–µ—Ö–æ–¥–∏–º.
          router.push(`/${targetLangCode}/post/${currentSlug}`);
        } else {
          // –£–í–´: –°—Ç–∞—Ç—å–∏ –Ω–µ—Ç.
          
          // –ü–æ–ª—É—á–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ –¶–ï–õ–ï–í–û–ú —è–∑—ã–∫–µ (–∫—É–¥–∞ —Ö–æ—Ç–µ–ª–∏ –ø–µ—Ä–µ–π—Ç–∏)
          const message = NO_ARTICLE_MESSAGES[targetLangCode] || NO_ARTICLE_MESSAGES.en;
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
          showToast(message, "info");
          
          // –ü–µ—Ä–µ–∫–∏–¥—ã–≤–∞–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞
          router.push(`/${targetLangCode}`);
        }
      } else {
        // 2. –û–ë–´–ß–ù–ê–Ø –°–¢–†–ê–ù–ò–¶–ê (–ì–ª–∞–≤–Ω–∞—è, –ü–æ–∏—Å–∫, –ó–∞–∫–ª–∞–¥–∫–∏) - –ø—Ä–æ—Å—Ç–æ –º–µ–Ω—è–µ–º —è–∑—ã–∫ –≤ URL
        if (languages.some(l => l.code === segments[0])) {
          segments[0] = targetLangCode;
          router.push(`/${segments.join("/")}`);
        } else {
          // –ï—Å–ª–∏ URL –±—ã–ª –∫–æ—Ä–Ω–µ–º, –¥–æ–±–∞–≤–ª—è–µ–º —è–∑—ã–∫
          router.push(`/${targetLangCode}/${segments.join("/")}`);
        }
      }
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ —è–∑—ã–∫–∞:", error);
      // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é
      router.push(`/${targetLangCode}`);
    } finally {
      setIsLoading(false);
      router.refresh();
    }
  };

  return (
    <div 
      id="desktop-lang-switcher" 
      className="hidden md:flex items-center bg-gray-100/80 dark:bg-zinc-800/80 rounded-full p-1 gap-1"
    >
      {languages.map((lang) => {
        const isActive = pathname?.startsWith(`/${lang.code}`);

        return (
          <button
            key={lang.code}
            onClick={() => handleLanguageChange(lang.code)}
            disabled={isLoading}
            className={`text-xs font-bold px-3 py-1.5 rounded-full transition-all cursor-pointer ${
              isActive
                ? "bg-blue-600 text-white shadow-md scale-105"
                : "text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-zinc-700"
            } ${isLoading ? "opacity-50 cursor-wait" : ""}`}
          >
            {lang.label}
          </button>
        );
      })}
    </div>
  );
}
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/lib/sanity.ts">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Sanity Client & Image Builder ===
import { createClient } from "next-sanity";
import imageUrlBuilder from "@sanity/image-url";

export const client = createClient({
  projectId: process.env.NEXT_PUBLIC_SANITY_PROJECT_ID || "dp2yjc73", // –¢–≤–æ–π ID
  dataset: process.env.NEXT_PUBLIC_SANITY_DATASET || "production",
  apiVersion: "2024-02-16", 
  useCdn: false, // –û—Ç–∫–ª—é—á–∞–µ–º –∫—ç—à, –∫–∞–∫ —Ç—ã –∏ —Ö–æ—Ç–µ–ª
});

// –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å—Ç—Ä–æ–∏—Ç–µ–ª—å —Å—Å—ã–ª–æ–∫ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∏
const builder = imageUrlBuilder(client);

// –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä—É—é –∏—â–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç–∏–Ω–æ–∫
export function urlFor(source: any) {
  return builder.image(source);
}
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/app/[lang]/bookmarks/page.tsx">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Bookmarks Page (Fix Layout Text Crop) ===
"use client";

import { useEffect, useState, use } from "react"; // –ò—Å–ø–æ–ª—å–∑—É–µ–º use –¥–ª—è params
import Link from "next/link";
import Image from "next/image";
import { client } from "@/lib/sanity";
import { bookmarkedArticlesQuery } from "@/lib/queries";
import BookmarkButton from "@/components/ui/BookmarkButton";
import { Loader2 } from "lucide-react";

// –°–ª–æ–≤–∞—Ä–∏ –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏ —á—Ç–µ–Ω–∏—è (–∑–∞–≤–∏—Å—è—Ç –æ—Ç —è–∑—ã–∫–∞ —Å—Ç–∞—Ç—å–∏)
const TIME_LABELS: Record<string, string> = {
  ru: "–º–∏–Ω",
  en: "min",
  ua: "—Ö–≤",
  pl: "min",
  de: "Min",
};

// –°–ª–æ–≤–∞—Ä–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (–∑–∞–≤–∏—Å—è—Ç –æ—Ç —è–∑—ã–∫–∞ —Å–∞–π—Ç–∞)
const UI_TEXT: Record<string, { title: string; empty: string; loading: string; back: string }> = {
  ru: { title: "–ò–∑–±—Ä–∞–Ω–Ω–æ–µ", empty: "–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π", loading: "–ó–∞–≥—Ä—É–∑–∫–∞...", back: "–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é" },
  en: { title: "Bookmarks", empty: "You haven't saved any articles yet", loading: "Loading...", back: "Back to home" },
  ua: { title: "–ó–±–µ—Ä–µ–∂–µ–Ω–µ", empty: "–£ –≤–∞—Å –ø–æ–∫–∏ –Ω–µ–º–∞—î –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö —Å—Ç–∞—Ç–µ–π", loading: "–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...", back: "–ù–∞ –≥–æ–ª–æ–≤–Ω—É" },
  pl: { title: "Zak≈Çadki", empty: "Nie masz jeszcze zapisanych artyku≈Ç√≥w", loading: "≈Åadowanie...", back: "Wr√≥ƒá do strony g≈Ç√≥wnej" },
  de: { title: "Lesezeichen", empty: "Sie haben noch keine Artikel gespeichert", loading: "Laden...", back: "Zur√ºck zur Startseite" },
};

interface Article {
  _id: string;
  title: string;
  slug: string;
  category: string;
  readTime: number;
  expert: boolean;
  mainImage: string;
  language: string; 
}

// Next.js 15: params —ç—Ç–æ Promise
export default function BookmarksPage({ params }: { params: Promise<{ lang: string }> }) {
  // 1. –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
  const { lang } = use(params);

  const [articles, setArticles] = useState<Article[]>([]);
  const [loading, setLoading] = useState(true);

  const t = UI_TEXT[lang as keyof typeof UI_TEXT] || UI_TEXT.ru;

  useEffect(() => {
    const fetchBookmarks = async () => {
      // 1. –ü–æ–ª—É—á–∞–µ–º ID –∏–∑ localStorage
      const saved = localStorage.getItem("bookmarkedArticles");
      
      if (!saved) {
        setLoading(false);
        return;
      }
      
      const ids = JSON.parse(saved);
      if (ids.length === 0) {
        setLoading(false);
        return;
      }

      // 2. –î–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å –≤ Sanity (—Ç–µ–ø–µ—Ä—å –∑–∞–ø—Ä–æ—Å –Ω–µ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ —è–∑—ã–∫—É)
      try {
        const data = await client.fetch(bookmarkedArticlesQuery, { ids });
        setArticles(data);
      } catch (error) {
        console.error("Error fetching bookmarks:", error);
      } finally {
        setLoading(false);
      }
    };

    fetchBookmarks();
  }, []);

  // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏
  useEffect(() => {
    const handleStorageChange = () => {
       const saved = localStorage.getItem("bookmarkedArticles");
       const ids = saved ? JSON.parse(saved) : [];
       setArticles(prev => prev.filter(a => ids.includes(a._id)));
    };

    window.addEventListener('storage', handleStorageChange);
    window.addEventListener('bookmarksUpdated', handleStorageChange); 
    
    return () => {
      window.removeEventListener('storage', handleStorageChange);
      window.removeEventListener('bookmarksUpdated', handleStorageChange);
    };
  }, []);

  if (loading) {
    return (
      <div className="flex justify-center items-center min-h-[50vh]">
        <Loader2 className="w-8 h-8 animate-spin text-blue-600" />
      </div>
    );
  }

  return (
    <div className="max-w-4xl mx-auto px-4 py-10">
      <h1 className="text-3xl font-extrabold mb-8 dark:text-white">{t.title}</h1>

      {articles.length === 0 ? (
        <div className="text-center py-20 bg-gray-50 dark:bg-zinc-900 rounded-3xl border border-dashed border-gray-200 dark:border-zinc-800">
          <p className="text-gray-500 dark:text-gray-400 text-lg mb-6">{t.empty}</p>
          <Link href={`/${lang}`} className="btn-primary">
            {t.back}
          </Link>
        </div>
      ) : (
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
          {articles.map((post) => {
            // –õ–û–ì–ò–ö–ê –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –í –ó–ê–ö–õ–ê–î–ö–ê–•:
            const articleLang = post.language || lang || "ru";
            const timeLabel = TIME_LABELS[articleLang] || "min";

            return (
              <div key={post._id} className="group flex flex-col h-full bg-white dark:bg-zinc-900 border border-gray-100 dark:border-zinc-800 rounded-2xl overflow-hidden shadow-sm hover:shadow-md transition-shadow">
                 
                 {/* –í–ê–ñ–ù–û: flex-col flex-1 –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫—É –∑–∞–Ω–∏–º–∞—Ç—å –≤—Å—ë –¥–æ—Å—Ç—É–ø–Ω–æ–µ –º–µ—Å—Ç–æ –∏ —Ç–æ–ª–∫–∞—Ç—å —Ñ—É—Ç–µ—Ä –≤–Ω–∏–∑ */}
                 <Link href={`/${articleLang}/post/${post.slug}`} className="flex flex-col flex-1">
                    <div className="relative h-48 w-full shrink-0 overflow-hidden bg-gray-100">
                      {post.mainImage && (
                        <Image
                          src={post.mainImage}
                          alt={post.title}
                          fill
                          className="object-cover group-hover:scale-105 transition-transform duration-500"
                        />
                      )}
                    </div>
                    
                    {/* –£–±—Ä–∞–ª–∏ pb-16. –¢–µ–∫—Å—Ç —Ç–µ–ø–µ—Ä—å —Ç–µ—á–µ—Ç —Å–≤–æ–±–æ–¥–Ω–æ. */}
                    <div className="p-5">
                      <div className="text-xs font-bold text-blue-600 dark:text-blue-400 uppercase tracking-wider mb-2">
                        {post.category || "Psychology"}
                      </div>
                      <h3 className="text-xl font-bold text-gray-900 dark:text-white leading-tight">
                        {post.title}
                      </h3>
                    </div>
                 </Link>

                 {/* –§—É—Ç–µ—Ä: mt-auto –ø—Ä–∏–∂–∏–º–∞–µ—Ç –µ–≥–æ –∫ –Ω–∏–∑—É –∫–∞—Ä—Ç–æ—á–∫–∏. –ù–µ absolute! */}
                 <div className="p-5 pt-4 mt-auto flex items-center justify-between border-t border-gray-100 dark:border-zinc-800 bg-white dark:bg-zinc-900">
                    <span className="text-sm font-medium text-gray-500">
                      {post.readTime || 5} {timeLabel}
                    </span>
                    
                    <div className="z-10 relative" onClick={(e) => {
                        e.stopPropagation();
                    }}>
                      <BookmarkButton articleId={post._id} />
                    </div>
                 </div>
              </div>
            );
          })}
        </div>
      )}
    </div>
  );
}
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/app/[lang]/post/[slug]/page.tsx">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Single Post Page ===
import { client } from "@/lib/sanity";
import { groq } from "next-sanity";
import { PortableText } from "@portabletext/react";
import Link from "next/link";
import Image from "next/image"; 
import ProgressBar from "@/components/ui/ProgressBar"; 
import ArticleActions from "@/components/article/ArticleActions"; 
import BookmarkButton from "@/components/ui/BookmarkButton";
import { Metadata } from "next";
import TranslationProvider from "./TranslationProvider"; 

// –°–ª–æ–≤–∞—Ä–∏ –¥–ª—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã "–ù–µ –Ω–∞–π–¥–µ–Ω–æ" –∏ —Ñ—É—Ç–µ—Ä–∞ —Å—Ç–∞—Ç—å–∏
const postTranslations = {
  ru: { 
    notFoundTitle: "–°—Ç–∞—Ç—å—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞", 
    backHome: "–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é", 
    backBtn: "‚Üê –ù–∞–∑–∞–¥ –∫ —Å—Ç–∞—Ç—å—è–º",
    categoryDefault: "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è",
    minRead: "–º–∏–Ω —á—Ç–µ–Ω–∏—è",
    verified: "–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —ç–∫—Å–ø–µ—Ä—Ç–æ–º",
    footerTitle: "–ü–æ–Ω—Ä–∞–≤–∏–ª—Å—è –º–∞—Ç–µ—Ä–∏–∞–ª?",
    footerText: "–ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –Ω–∞—à–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –Ω–æ–≤—ã–µ —Å–æ–≤–µ—Ç—ã —ç–∫—Å–ø–µ—Ä—Ç–æ–≤."
  },
  en: { 
    notFoundTitle: "Article not found", 
    backHome: "Back to home", 
    backBtn: "‚Üê Back to articles",
    categoryDefault: "Psychology",
    minRead: "min read",
    verified: "Verified by expert",
    footerTitle: "Did you like this article?",
    footerText: "Subscribe to our updates so you don't miss new expert advice."
  },
  ua: { 
    notFoundTitle: "–°—Ç–∞—Ç—Ç—é –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ", 
    backHome: "–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –Ω–∞ –≥–æ–ª–æ–≤–Ω—É", 
    backBtn: "‚Üê –ù–∞–∑–∞–¥ –¥–æ —Å—Ç–∞—Ç–µ–π",
    categoryDefault: "–ü—Å–∏—Ö–æ–ª–æ–≥—ñ—è",
    minRead: "—Ö–≤ —á–∏—Ç–∞–Ω–Ω—è",
    verified: "–ü–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ –µ–∫—Å–ø–µ—Ä—Ç–æ–º",
    footerTitle: "–°–ø–æ–¥–æ–±–∞–≤—Å—è –º–∞—Ç–µ—Ä—ñ–∞–ª?",
    footerText: "–ü—ñ–¥–ø–∏—à—ñ—Ç—å—Å—è –Ω–∞ –Ω–∞—à—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è, —â–æ–± –Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ –Ω–æ–≤—ñ –ø–æ—Ä–∞–¥–∏ –µ–∫—Å–ø–µ—Ä—Ç—ñ–≤."
  },
  pl: { 
    notFoundTitle: "Nie znaleziono artyku≈Çu", 
    backHome: "Wr√≥ƒá do strony g≈Ç√≥wnej", 
    backBtn: "‚Üê Wr√≥ƒá do artyku≈Ç√≥w",
    categoryDefault: "Psychologia",
    minRead: "min czytania",
    verified: "Sprawdzone przez eksperta",
    footerTitle: "Podoba≈Ç Ci siƒô materia≈Ç?",
    footerText: "Zapisz siƒô na nasze aktualizacje, aby nie przegapiƒá nowych porad ekspert√≥w."
  },
  de: { 
    notFoundTitle: "Artikel nicht gefunden", 
    backHome: "Zur√ºck zur Startseite", 
    backBtn: "‚Üê Zur√ºck zu den Artikeln",
    categoryDefault: "Psychologie",
    minRead: "Minuten Lesezeit",
    verified: "Von Experten gepr√ºft",
    footerTitle: "Hat Ihnen der Artikel gefallen?",
    footerText: "Abonnieren Sie unsere Updates, um keine neuen Experten-Tipps zu verpassen."
  },
};

// 1. –ó–ê–ü–†–û–° –ò–ó–ú–ï–ù–ï–ù: –¢–µ–ø–µ—Ä—å –º—ã –ø–æ–ª—É—á–∞–µ–º –µ—â–µ translationId –∏ slugs –≤—Å–µ—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤
const postQuery = groq`*[_type == "post" && slug.current == $slug && language == $lang][0] {
  _id,
  title,
  body,
  publishedAt,
  category,
  readTime,
  expert,
  translationId,
  "mainImage": mainImage.asset->url,
  "plainText": pt::text(body),
  "translations": *[_type == "post" && translationId == ^.translationId] {
    language,
    "slug": slug.current
  }
}`;

export async function generateMetadata({ params }: { params: Promise<{ lang: string; slug: string }> }): Promise<Metadata> {
  const { lang, slug } = await params;
  const post = await client.fetch(postQuery, { lang, slug });

  const t = postTranslations[lang as keyof typeof postTranslations] || postTranslations.ru;

  if (!post) return { title: t.notFoundTitle };

  return {
    title: `${post.title} | HealthPsy`,
    description: post.plainText?.substring(0, 160) + "...",
    openGraph: {
      title: post.title,
      description: post.plainText?.substring(0, 160) + "...",
      images: post.mainImage ? [post.mainImage] : [],
      type: "article",
      publishedTime: post.publishedAt,
      authors: post.expert ? [post.expert] : [],
    },
  };
}

const portableTextComponents = {
  types: {
    youtube: ({ value }: any) => {
      const { url } = value;
      if (!url) return null;

      const isShorts = url.includes("shorts/");
      const videoId = isShorts 
        ? url.split("shorts/")[1].split(/[?#]/)[0] 
        : url.split("v=")[1]?.split("&")[0];

      return (
        <div id={`video-${videoId}`} className="my-10 flex justify-center">
          <div className={`w-full overflow-hidden rounded-3xl shadow-2xl bg-black ${
            isShorts ? "max-w-[315px] aspect-[9/16]" : "aspect-video"
          }`}>
            <iframe
              width="100%"
              height="100%"
              src={`https://www.youtube.com/embed/${videoId}`}
              title="YouTube video player"
              frameBorder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              allowFullScreen
              className="w-full h-full"
            ></iframe>
          </div>
        </div>
      );
    },
  },
  block: {
    // –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –±–ª–æ–∫–æ–≤ –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–π —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∏
    normal: ({ children }: any) => (
      <p className="mb-6 text-lg leading-relaxed text-gray-700 dark:text-zinc-300">
        {children}
      </p>
    ),
    h2: ({ children }: any) => (
      <h2 className="text-2xl sm:text-3xl font-extrabold tracking-tight mt-12 mb-6 text-gray-900 dark:text-white">
        {children}
      </h2>
    ),
    h3: ({ children }: any) => (
      <h3 className="text-xl sm:text-2xl font-bold mt-8 mb-4 text-gray-900 dark:text-white">
        {children}
      </h3>
    ),
    blockquote: ({ children }: any) => (
      <blockquote className="border-l-4 border-blue-600 pl-6 py-2 my-8 italic text-xl text-gray-800 dark:text-zinc-200 bg-gray-50 dark:bg-zinc-800/50 rounded-r-xl">
        {children}
      </blockquote>
    ),
    ul: ({ children }: any) => (
      <ul className="list-disc pl-6 mb-6 space-y-2 text-lg text-gray-700 dark:text-zinc-300 marker:text-blue-500">
        {children}
      </ul>
    ),
    ol: ({ children }: any) => (
      <ol className="list-decimal pl-6 mb-6 space-y-2 text-lg text-gray-700 dark:text-zinc-300 marker:font-bold">
        {children}
      </ol>
    ),
  },
};

interface PostPageProps {
  params: Promise<{ lang: string; slug: string }>;
}

export default async function PostPage({ params }: PostPageProps) {
  const { lang, slug } = await params;
  const t = postTranslations[lang as keyof typeof postTranslations] || postTranslations.ru;
  const post = await client.fetch(postQuery, { lang, slug });

  if (!post) {
    return (
      <main id="post-not-found" className="flex items-center justify-center min-h-[50vh]">
        <div className="text-center">
          <h1 className="text-2xl font-bold mb-4 font-sans">{t.notFoundTitle}</h1>
          <Link href={`/${lang}`} className="text-blue-600 hover:underline">{t.backHome}</Link>
        </div>
      </main>
    );
  }

  const textForAudio = post.plainText || post.title;

  const jsonLd = {
    "@context": "https://schema.org",
    "@type": "Article",
    headline: post.title,
    image: post.mainImage ? [post.mainImage] : [],
    datePublished: post.publishedAt,
    author: {
      "@type": "Person",
      name: post.expert || "–†–µ–¥–∞–∫—Ü–∏—è",
    },
    timeRequired: `PT${post.readTime || 5}M`,
  };

  const translationMap = post.translations?.reduce((acc: any, curr: any) => {
    if (curr.language && curr.slug) {
      acc[curr.language] = curr.slug;
    }
    return acc;
  }, {}) || {};

  return (
    <>
      <script
        type="application/ld+json"
        dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}
      />
      
      <ProgressBar />
      
      <TranslationProvider translations={translationMap} currentLang={lang} />
      
      <main id="post-main-content" className="font-sans">
        <article id="post-article" className="layout-container max-w-3xl mx-auto">
          
          <nav id="post-navigation" className="mb-8">
            <Link
              href={`/${lang}`}
              className="text-sm font-bold text-zinc-500 hover:text-blue-600 transition-colors flex items-center gap-2"
            >
              {t.backBtn}
            </Link>
          </nav>

          <header id="post-header">
            <h1 id="post-title" className="text-3xl md:text-5xl font-black text-gray-900 dark:text-zinc-50 mb-6 leading-tight">
              {post.title}
            </h1>

            <div className="flex items-center justify-between mb-10">
              <div id="post-meta" className="flex flex-wrap items-center gap-4 text-sm font-medium">
                <span className="bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest">
                  {post.category || t.categoryDefault}
                </span>
                <span className="text-gray-400 dark:text-zinc-500">
                  {post.readTime || 5} {t.minRead}
                </span>
                <time className="text-gray-400 dark:text-zinc-500 hidden sm:inline-block">
                  {new Date(post.publishedAt).toLocaleDateString(lang === "en" ? "en-US" : "ru-RU")}
                </time>
                {post.expert && (
                  <span className="text-green-600 dark:text-green-400 font-bold flex items-center gap-1">
                    ‚úì <span className="hidden sm:inline-block">{t.verified}</span>
                  </span>
                )}
              </div>

              <div className="shrink-0 pl-4">
                <BookmarkButton articleId={post._id} />
              </div>
            </div>
          </header>

          {post.mainImage && (
            <div id="post-hero-image" className="relative w-full aspect-video rounded-3xl overflow-hidden mb-12 shadow-2xl">
              <Image 
                src={post.mainImage} 
                alt={post.title} 
                fill
                priority
                sizes="(max-width: 768px) 100vw, 768px"
                className="object-cover w-full h-full"
              />
            </div>
          )}

          {/* üëá –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ó–î–ï–°–¨: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ lang –≤ ArticleActions üëá */}
          <ArticleActions title={post.title} textToRead={textForAudio} lang={lang} />

          <div id="post-body" className="prose prose-zinc dark:prose-invert max-w-none 
            prose-lg 
            prose-p:text-gray-700 dark:prose-p:text-zinc-200 
            prose-p:leading-relaxed 
            prose-headings:font-black 
            prose-a:text-blue-600 dark:prose-a:text-blue-400">
            
            <PortableText 
              value={post.body} 
              components={portableTextComponents} 
            />
            
          </div>

          <footer id="post-footer" className="p-8 bg-gray-50 dark:bg-zinc-900 rounded-3xl border border-gray-200 dark:border-zinc-800 mt-16 text-center">
              <h3 className="text-lg font-bold mb-2">{t.footerTitle}</h3>
              <p className="text-gray-500 dark:text-zinc-400 text-sm">
                {t.footerText}
              </p>
          </footer>

        </article>
      </main>
    </>
  );
}
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/package.json">
{
  "name": "psy-front",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "@portabletext/react": "^6.0.2",
    "@sanity/client": "^7.15.0",
    "@sanity/document-internationalization": "^5.0.1",
    "@sanity/image-url": "^2.0.3",
    "@tailwindcss/typography": "^0.5.19",
    "@vercel/analytics": "^1.6.1",
    "algoliasearch": "^5.48.1",
    "lucide-react": "^0.564.0",
    "next": "16.1.6",
    "next-sanity": "^12.1.0",
    "next-themes": "^0.4.6",
    "postcss": "^8.5.6",
    "react": "19.2.3",
    "react-dom": "19.2.3",
    "react-instantsearch": "^7.23.2",
    "sanity": "^5.9.0",
    "styled-components": "^6.3.9"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4.1.18",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "eslint": "^9",
    "eslint-config-next": "16.1.6",
    "tailwindcss": "^4.1.18",
    "typescript": "^5"
  }
}
</file>

<file path="psy-front/app/layout.tsx">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Root Layout ===
import type { Metadata, Viewport } from "next"; 
import { Inter } from "next/font/google";
import { ThemeProvider } from "next-themes";
import "./globals.css";
import BottomBar from "@/components/ui/BottomBar"; 
import Header from "@/components/ui/Header"; 
// –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
import { ToastProvider } from "@/components/ui/ToastProvider"; 
// –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ Vercel
import { Analytics } from "@vercel/analytics/react";

const inter = Inter({ subsets: ["latin", "cyrillic"] });

export const viewport: Viewport = {
  width: "device-width",
  initialScale: 1,
  maximumScale: 1,
  userScalable: false,
  viewportFit: "cover",
};

export const metadata: Metadata = {
  title: "HealthPsy",
  description: "–¢–≤–æ–π –ø—Ä–æ–≤–æ–¥–Ω–∏–∫ –≤ –º–µ–Ω—Ç–∞–ª—å–Ω–æ–º –º–∏—Ä–µ",
  icons: {
    icon: "/favicon.ico",
    shortcut: "/favicon.ico",
    apple: "/favicon.ico",
  },
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="ru" suppressHydrationWarning>
      <body id="root-body" className={`${inter.className} bg-background text-foreground antialiased`}>
        <ThemeProvider attribute="class" defaultTheme="system" enableSystem>
          {/* –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º –≤—Å—ë –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ ToastProvider –¥–ª—è —Ä–∞–±–æ—Ç—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */}
          <ToastProvider>
            
            <div id="app-wrapper" className="relative flex min-h-screen flex-col">
              
              <Header />
              
              {/* –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±–µ—Ä—Ç–∫–∞ –æ—Ç—Å—Ç—É–ø–æ–≤: –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –Ω–∞–ª–æ–∂–µ–Ω–∏—è Header –∏ BottomBar */}
              <div id="main-content" className="flex-1 pt-20 md:pt-28 pb-24 md:pb-12">
                {children}
              </div>
              
              <BottomBar />
              
            </div>

            {/* –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ Vercel (—Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∏–ª–∏ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ –Ω–∞ Vercel) */}
            <Analytics />

          </ToastProvider>
        </ThemeProvider>
      </body>
    </html>
  );
}
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-admin/schemaTypes/post.ts">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Sanity Post Schema (Updated) ===
import { defineField, defineType } from 'sanity'

export default defineType({
  name: 'post',
  title: '–°—Ç–∞—Ç—å—è (Post)',
  type: 'document',
  fields: [
    defineField({
      name: 'title',
      title: 'Title (–ó–∞–≥–æ–ª–æ–≤–æ–∫)',
      type: 'string',
      validation: (Rule) => Rule.required(),
    }),
    defineField({
      name: 'slug',
      title: 'Slug (URL —Å—Ç–∞—Ç—å–∏)',
      type: 'slug',
      options: {
        source: 'title',
        maxLength: 96,
        // üëá –ò–ó–ú–ï–ù–ï–ù–û: –°—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ —Å–ª–∞–≥–∞ –¥–ª—è –í–°–ï–• —è–∑—ã–∫–æ–≤
        isUnique: async (value, context) => {
          const { document, getClient } = context;
          const client = getClient({ apiVersion: '2024-02-16' });
          const id = document?._id.replace(/^drafts\./, '');
          
          const params = {
            draft: `drafts.${id}`,
            published: id,
            slug: value as string,
          };
          
          // –£–±—Ä–∞–ª–∏ –ø—Ä–∏–≤—è–∑–∫—É –∫ —è–∑—ã–∫—É. –¢–µ–ø–µ—Ä—å —Å–ª–∞–≥ –∏—â–µ—Ç—Å—è –ø–æ –≤—Å–µ–π –±–∞–∑–µ.
          const query = `!defined(*[!(_id in [$draft, $published]) && slug.current == $slug][0]._id)`;
          return await client.fetch(query, params);
        },
      },
      validation: (Rule) => Rule.required(),
    }),
    defineField({
      name: 'language',
      title: 'üåê –Ø–∑—ã–∫ —Å—Ç–∞—Ç—å–∏',
      type: 'string',
      readOnly: true, // –ü–æ–ª–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–ª–∞–≥–∏–Ω–æ–º document-internationalization
    }),
    
    defineField({
        name: 'translationId',
        title: 'Translation ID (Group ID)',
        type: 'string',
        description: '–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π ID –¥–ª—è –≤—Å–µ—Ö –≤–µ—Ä—Å–∏–π –æ–¥–Ω–æ–π —Å—Ç–∞—Ç—å–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "anxiety-01"). –≠—Ç–æ —Å–≤—è–∂–µ—Ç –∏—Ö –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–º.',
    }),
    
    defineField({
      name: 'category',
      title: 'Category (Legacy Tag)',
      type: 'string',
      hidden: false, 
      description: '–°—Ç–∞—Ä–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)',
    }),
    defineField({
      name: 'author',
      title: 'Author',
      type: 'reference',
      to: { type: 'author' },
    }),
    defineField({
      name: 'mainImage',
      title: 'Main image',
      type: 'image',
      options: { hotspot: true },
    }),
    defineField({
      name: 'categories',
      title: 'Categories',
      type: 'array',
      of: [{ type: 'reference', to: { type: 'category' } }],
    }),
    defineField({
      name: 'publishedAt',
      title: 'Published at',
      type: 'datetime',
      initialValue: () => new Date().toISOString(),
    }),
    
    defineField({
      name: 'readTime',
      title: '‚è≥ –í—Ä–µ–º—è —á—Ç–µ–Ω–∏—è (–≤ –º–∏–Ω—É—Ç–∞—Ö)',
      type: 'number',
      validation: (Rule) => Rule.min(1).max(60),
    }),
    defineField({
      name: 'readingTime',
      title: '[–£–°–¢–ê–†–ï–õ–û] –í—Ä–µ–º—è —á—Ç–µ–Ω–∏—è',
      type: 'number',
      hidden: true,
    }),
    defineField({
      name: 'expert',
      title: 'üß† –ú–Ω–µ–Ω–∏–µ –ø—Å–∏—Ö–æ–ª–æ–≥–∞ (E-E-A-T)',
      description: '–ü–æ—Å—Ç–∞–≤—å –≥–∞–ª–æ—á–∫—É, –µ—Å–ª–∏ —Å—Ç–∞—Ç—å—é –ø—Ä–æ–≤–µ—Ä—è–ª –∏–ª–∏ –ø–∏—Å–∞–ª —ç–∫—Å–ø–µ—Ä—Ç',
      type: 'boolean',
      initialValue: false,
    }),
    defineField({
      name: 'expertReview',
      title: '[–£–°–¢–ê–†–ï–õ–û] –ú–Ω–µ–Ω–∏–µ –ø—Å–∏—Ö–æ–ª–æ–≥–∞',
      type: 'boolean',
      hidden: true,
    }),
    defineField({
      name: 'youtubeShorts',
      title: 'YouTube Shorts (–ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω—ã–π)',
      type: 'object',
      fields: [
        { name: 'ru', type: 'url', title: '–í–∏–¥–µ–æ (RU)' },
        { name: 'en', type: 'url', title: '–í–∏–¥–µ–æ (EN)' },
        { name: 'ua', type: 'url', title: '–í–∏–¥–µ–æ (UA)' },
        { name: 'pl', type: 'url', title: '–í–∏–¥–µ–æ (PL)' },
        { name: 'de', type: 'url', title: '–í–∏–¥–µ–æ (DE)' },
      ]
    }),
    defineField({
      name: 'body',
      title: 'Body (–¢–µ–∫—Å—Ç)',
      type: 'blockContent',
    }),
  ],

  preview: {
    select: {
      title: 'title',
      author: 'author.name',
      media: 'mainImage',
      lang: 'language',
    },
    prepare(selection) {
      const { author, title, media, lang } = selection;
      return {
        title: title,
        subtitle: `${lang ? lang.toUpperCase() : 'RU'} ${author ? `| by ${author}` : ''}`,
        media: media,
      }
    },
  },
})
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

<file path="psy-front/lib/queries.ts">
// === –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê: Sanity Queries ===
import { groq } from "next-sanity";

// 1. –ó–∞–ø—Ä–æ—Å –¥–ª—è –ª–µ–Ω—Ç—ã –∏ –ø–æ–∏—Å–∫–∞ (—É—á–∏—Ç—ã–≤–∞–µ—Ç —è–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞)
// –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ—Å—Ç—ã —Ç–µ–∫—É—â–µ–≥–æ —è–∑—ã–∫–∞, –ª–∏–±–æ –ø–æ—Å—Ç—ã –±–µ–∑ —è–∑—ã–∫–∞ (—Å—Ç–∞—Ä—ã–µ), —Å—á–∏—Ç–∞—è –∏—Ö —Ä—É—Å—Å–∫–∏–º–∏
export const articlesQuery = groq`*[_type == "post" && (language == $lang || (!defined(language) && $lang == 'ru'))] | order(publishedAt desc) {
  _id,
  title,
  "slug": slug.current,
  category,
  "readTime": coalesce(readingTime, readTime),
  "expert": coalesce(expertReview, expert),
  "mainImage": mainImage.asset->url,
  language
}`;

// 2. –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ó–ê–ü–†–û–° –ó–ê–ö–õ–ê–î–û–ö
// –í–ê–ñ–ù–û: –£–±—Ä–∞–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —è–∑—ã–∫—É. –ò—â–µ–º –ø—Ä–æ—Å—Ç–æ –ø–æ ID.
export const bookmarkedArticlesQuery = groq`*[_type == "post" && _id in $ids] | order(publishedAt desc) {
  _id,
  title,
  "slug": slug.current,
  category,
  "readTime": coalesce(readingTime, readTime),
  "expert": coalesce(expertReview, expert),
  "mainImage": mainImage.asset->url,
  language
}`;

// 3. –ó–∞–ø—Ä–æ—Å –æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç–∞
export const singlePostQuery = groq`*[_type == "post" && slug.current == $slug][0] {
  _id,
  title,
  "slug": slug.current,
  mainImage,
  body,
  publishedAt,
  author->{name, image},
  language,
  "related": *[_type == "post" && category._ref == ^.category._ref && _id != ^._id][0..2] {
    title,
    "slug": slug.current,
    "mainImage": mainImage.asset->url
  }
}`;
// === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê ===
</file>

</files>
